<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SuiteCRM Outlook Add-in: SuiteCRMAddIn/BusinessLogic/Synchroniser.cs Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="SuiteCRM.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SuiteCRM Outlook Add-in
   &#160;<span id="projectnumber">3.0.22.0</span>
   </div>
   <div id="projectbrief">An outlook add-in which allows synchronisation with SuiteCRM</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_synchroniser_8cs_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Synchroniser.cs</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_synchroniser_8cs.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#region</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Collections.Generic;</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Globalization;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Linq;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="keyword">using</span> Microsoft.Office.Interop.Outlook;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="keyword">using</span> Newtonsoft.Json;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_suite_c_r_m_add_in.html">SuiteCRMAddIn</a>.<a class="code" href="namespace_suite_c_r_m_add_in_1_1_daemon.html">Daemon</a>;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_suite_c_r_m_add_in.html">SuiteCRMAddIn</a>.<a class="code" href="namespace_suite_c_r_m_add_in_1_1_exceptions.html">Exceptions</a>;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_suite_c_r_m_add_in.html">SuiteCRMAddIn</a>.<a class="code" href="namespace_suite_c_r_m_add_in_1_1_properties.html">Properties</a>;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_suite_c_r_m_client.html">SuiteCRMClient</a>;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_suite_c_r_m_client.html">SuiteCRMClient</a>.<a class="code" href="namespace_suite_c_r_m_client_1_1_logging.html">Logging</a>;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_suite_c_r_m_client.html">SuiteCRMClient</a>.<a class="code" href="namespace_suite_c_r_m_client_1_1_r_e_s_t_objects.html">RESTObjects</a>;</div><div class="line"><a name="l00038"></a><span class="lineno"><a class="line" href="_synchroniser_8cs.html#ae0096c4585272961d2ac22652ff118e2">   38</a></span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_exception.html">Exception</a> = <a class="code" href="namespace_system.html">System</a>.Exception;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Runtime.InteropServices;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#endregion</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespace_suite_c_r_m_add_in.html">SuiteCRMAddIn</a>.BusinessLogic</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;{</div><div class="line"><a name="l00045"></a><span class="lineno"><a class="line" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html">   45</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class </span><a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html">Synchroniser</a> : <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_repeating_process.html">RepeatingProcess</a></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    {</div><div class="line"><a name="l00047"></a><span class="lineno"><a class="line" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#ad461e0df84105575ef48b4a994f06192">   47</a></span>&#160;        <span class="keyword">public</span> <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#ad461e0df84105575ef48b4a994f06192">Synchroniser</a>(<span class="keywordtype">string</span> name, <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_context.html">SyncContext</a> context) : base(name, context.Log)</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;        {</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;            Context = context;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;        }</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div><div class="line"><a name="l00052"></a><span class="lineno"><a class="line" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#acc900146fe39142e5c6c3c5fad2bdeb8">   52</a></span>&#160;        <span class="keyword">protected</span> Application Application =&gt; Context.<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_context.html#a5a83c6e29927537191c0755578c5569b">Application</a>;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div><div class="line"><a name="l00057"></a><span class="lineno"><a class="line" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a50c5a86d0eb42e45ae474231ea98fecb">   57</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keywordtype">string</span> DefaultCrmModule { <span class="keyword">get</span>; }</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div><div class="line"><a name="l00062"></a><span class="lineno"><a class="line" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#abd22e0acc255bb6e6c3c0f6912c709de">   62</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">abstract</span> <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_direction.html">SyncDirection</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_direction.html#aee195368e938ed8e05fa3ec669838c06">Direction</a> Direction { <span class="keyword">get</span>; }</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div><div class="line"><a name="l00067"></a><span class="lineno"><a class="line" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a8dbc2f5e5dcacf5c48fea9b20a96ed7e">   67</a></span>&#160;        <span class="keyword">protected</span> <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_context.html">SyncContext</a> Context { <span class="keyword">get</span>; }</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        <span class="keyword">public</span> <span class="keyword">abstract</span> MAPIFolder GetDefaultFolder();</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div><div class="line"><a name="l00079"></a><span class="lineno"><a class="line" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a0de4a3f57b7174d19b7e44011a40a444">   79</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a0de4a3f57b7174d19b7e44011a40a444">PerformStartup</a>()</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        {</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;            LinkOutlookItems(GetDefaultFolder());</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        }</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        <span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keywordtype">void</span> LinkOutlookItems(MAPIFolder folder);</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        <span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keywordtype">void</span> SyncFolder(MAPIFolder folder, <span class="keywordtype">string</span> crmModule);</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    }</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div><div class="line"><a name="l00105"></a><span class="lineno"><a class="line" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html">  105</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class </span><a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html">Synchroniser</a>&lt;OutlookItemType, SyncStateType&gt; : <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html">Synchroniser</a>, IDisposable</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        where OutlookItemType : class</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        where SyncStateType : <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state.html">SyncState</a>&lt;OutlookItemType&gt;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    {</div><div class="line"><a name="l00112"></a><span class="lineno"><a class="line" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#ae70f557504f2456395b04b772ddc3753">  112</a></span>&#160;        <span class="keyword">protected</span> readonly <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_c_r_m_permissions_cache.html">CRMPermissionsCache&lt;OutlookItemType, SyncStateType&gt;</a> <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#ae70f557504f2456395b04b772ddc3753">permissionsCache</a>;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        <span class="comment">// Keep a reference to the COM object on which we have event handlers, otherwise</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        <span class="comment">// when the reference is garbage-collected, the event-handlers are removed!</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        <span class="keyword">private</span> Items _itemsCollection;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div><div class="line"><a name="l00121"></a><span class="lineno"><a class="line" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a8d3a1efaff89ebc0b41c0bea85f32d89">  121</a></span>&#160;        <span class="keyword">protected</span> <span class="keywordtype">object</span> creationLock = <span class="keyword">new</span> object();</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;</div><div class="line"><a name="l00126"></a><span class="lineno"><a class="line" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a9328354ea6ff4417ae89a52fd3a3aecc">  126</a></span>&#160;        <span class="keyword">protected</span> JsonSerializerSettings DeserialiseSettings = <span class="keyword">new</span> JsonSerializerSettings</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        {</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;            StringEscapeHandling = StringEscapeHandling.EscapeHtml</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        };</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div><div class="line"><a name="l00136"></a><span class="lineno"><a class="line" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a73d381653a6fce076d31cf3159c57861">  136</a></span>&#160;        <span class="keyword">protected</span> <span class="keywordtype">object</span> enqueueingLock = <span class="keyword">new</span> object();</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div><div class="line"><a name="l00141"></a><span class="lineno"><a class="line" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a4038c28ad028c598dffb4e07920296d0">  141</a></span>&#160;        <span class="keyword">protected</span> <span class="keywordtype">string</span> <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a4038c28ad028c598dffb4e07920296d0">fetchQueryPrefix</a>;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        <span class="keyword">private</span> <span class="keywordtype">string</span> folderName;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;</div><div class="line"><a name="l00150"></a><span class="lineno"><a class="line" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a78c2542df90d2227cbdf0a8729d592e4">  150</a></span>&#160;        <span class="keyword">public</span> <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a78c2542df90d2227cbdf0a8729d592e4">Synchroniser</a>(<span class="keywordtype">string</span> threadName, <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_context.html">SyncContext</a> context) : base(threadName, context)</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        {</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;            InstallEventHandlers();</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;            AddSuiteCrmOutlookCategory();</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;            permissionsCache = <span class="keyword">new</span> <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_c_r_m_permissions_cache.html">CRMPermissionsCache&lt;OutlookItemType, SyncStateType&gt;</a>(<span class="keyword">this</span>, context.<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_context.html#ac800c823d97baf0a18035333cb1fbe2d">Log</a>);</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        }</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;</div><div class="line"><a name="l00157"></a><span class="lineno"><a class="line" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a5cd22de84e141952672c751ecaad520b">  157</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a5cd22de84e141952672c751ecaad520b">Dispose</a>()</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        {</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;            <span class="comment">// RemoveEventHandlers();</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        }</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div><div class="line"><a name="l00166"></a><span class="lineno"><a class="line" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#aaeeca4690fad8a84a4524658be17d7dc">  166</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">bool</span> <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#aaeeca4690fad8a84a4524658be17d7dc">IsEnabled</a>()</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        {</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="class_suite_c_r_m_add_in_1_1_globals.html">Globals</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_globals.html#a7003a84165898c49d89498f9bd9659c5">ThisAddIn</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_this_add_in.html#ac6234db8eca55ca418b5043365bfdec3">HasCrmUserSession</a> &amp;&amp;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;                   (<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_direction.html">SyncDirection</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_direction.html#a96a16ea01111b3c05734e87d75eeef96">AllowInbound</a>(Direction) ||</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;                    <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_direction.html">SyncDirection</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_direction.html#ad456cb19bab5eb78bc35f7b305274d01">AllowOutbound</a>(Direction));</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        }</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div><div class="line"><a name="l00177"></a><span class="lineno"><a class="line" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a3085a2b7a41e3b043d7cfa9160009e3c">  177</a></span>&#160;        <span class="keyword">public</span> DateTime <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a3085a2b7a41e3b043d7cfa9160009e3c">GetStartDate</a>()</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        {</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;            var dtRet = DateTime.Now.AddDays(-5);</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">new</span> DateTime(dtRet.Year, dtRet.Month, dtRet.Day, 0, 0, 0);</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        }</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;</div><div class="line"><a name="l00187"></a><span class="lineno"><a class="line" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#acf44d5faca57f157a7e50706eb4b28d2">  187</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">string</span> <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#acf44d5faca57f157a7e50706eb4b28d2">GetStartDateString</a>()</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        {</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;            <span class="keywordflow">return</span> $<span class="stringliteral">&quot; AND [Start] &gt;=&#39;{GetStartDate().ToString(&quot;</span>MM/dd/yyyy HH:mm<span class="stringliteral">&quot;)}&#39;&quot;</span>;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        }</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;</div><div class="line"><a name="l00196"></a><span class="lineno"><a class="line" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a786c50482874e295e00fd79c009b478e">  196</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">int</span> <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a786c50482874e295e00fd79c009b478e">PrepareShutdown</a>()</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        {</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;            RemoveEventHandlers();</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;            <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        }</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;</div><div class="line"><a name="l00205"></a><span class="lineno"><a class="line" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#ad231f4994aa37e0030879afff29d2f8c">  205</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#ad231f4994aa37e0030879afff29d2f8c">SynchroniseAll</a>()</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        {</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;            Log.Debug($<span class="stringliteral">&quot;{GetType().Name} SynchroniseAll starting&quot;</span>);</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;            <span class="keywordflow">if</span> (permissionsCache.HasExportAccess())</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;            {</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                var folder = GetDefaultFolder();</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;                SyncFolder(folder, DefaultCrmModule);</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;            }</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;            {</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;                Log.Debug(</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                    $<span class="stringliteral">&quot;{GetType().Name}.SynchroniseAll not synchronising {DefaultCrmModule} because export access is denied&quot;</span>);</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;            }</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;            Log.Debug($<span class="stringliteral">&quot;{GetType().Name} SynchroniseAll completed&quot;</span>);</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        }</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;</div><div class="line"><a name="l00229"></a><span class="lineno"><a class="line" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a4d2408df659e4a9e60d08c22ef9843b7">  229</a></span>&#160;        <span class="keyword">internal</span> <span class="keyword">virtual</span> <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_crm_id.html">CrmId</a> <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a4d2408df659e4a9e60d08c22ef9843b7">AddOrUpdateItemFromOutlookToCrm</a>(<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state.html">SyncState&lt;OutlookItemType&gt;</a> syncState)</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        {</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;            var result = <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_crm_id.html">CrmId</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_crm_id.html#a602096cd3ec71629ce3da05e4a037550">Empty</a>;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;            lock (enqueueingLock)</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;            {</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                <span class="keywordflow">if</span> (!syncState.VerifyItem())</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                {</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                    <span class="comment">// TODO: this puts us into a death spiral, if item is a meeting. </span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                    HandleItemMissingFromOutlook(syncState);</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                }</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ShouldAddOrUpdateItemFromOutlookToCrm(syncState.OutlookItem))</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                {</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;                    var olItem = syncState.OutlookItem;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                    <span class="keywordflow">try</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                    {</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                        LogItemAction(olItem, <span class="stringliteral">&quot;Synchroniser.AddOrUpdateItemFromOutlookToCrm, Despatching&quot;</span>);</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                        <span class="keywordflow">try</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                        {</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                            syncState.SetTransmitted();</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                            result = ConstructAndDespatchCrmItem(syncState);</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                            <span class="keywordflow">if</span> (<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_crm_id.html">CrmId</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_crm_id.html#ae8a022a1d7034b495864a55ede1e0e72">IsValid</a>(result))</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                            {</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                                var utcNow = DateTime.UtcNow;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                                EnsureSynchronisationPropertiesForOutlookItem(olItem, utcNow.ToString(),</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                                    DefaultCrmModule, result);</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;                                syncState.SetSynced(result);</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                            }</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                            <span class="keywordflow">else</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;                            {</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                                Log.Warn(</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                                    <span class="stringliteral">&quot;AppointmentSyncing.AddItemFromOutlookToCrm: Invalid CRM Id returned; item may not be stored.&quot;</span>);</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;                                syncState.SetPending(<span class="keyword">true</span>);</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;                            }</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                        }</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                        <span class="keywordflow">catch</span> (<a class="code" href="class_suite_c_r_m_add_in_1_1_exceptions_1_1_bad_state_transition.html">BadStateTransition</a> bst)</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                        {</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                            <span class="comment">/* almost certainly the item had been taken out of the queue because</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="comment">                             * it had changed, and that&#39;s OK */</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                            <span class="keywordflow">if</span> (bst.<a class="code" href="class_suite_c_r_m_add_in_1_1_exceptions_1_1_bad_state_transition.html#a1479efcb8b54c404c2c2c646818d3525">From</a> != <a class="code" href="namespace_suite_c_r_m_add_in_1_1_business_logic.html#a46e26c41850a74036449e03576981875">TransmissionState</a>.Pending)</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                                Log.Warn($<span class="stringliteral">&quot;Unexpected error while transmitting {DefaultCrmModule}.&quot;</span>, bst);</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                        }</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                        <span class="keywordflow">catch</span> (<a class="code" href="namespace_exception.html">Exception</a> any)</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                        {</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                            Log.Warn($<span class="stringliteral">&quot;Unexpected error while transmitting {DefaultCrmModule}.&quot;</span>, any);</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                        }</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                    }</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;                    <span class="keywordflow">catch</span> (<a class="code" href="namespace_exception.html">Exception</a> ex)</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                    {</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;                        <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_error_handler.html">ErrorHandler</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_error_handler.html#aa5ac5699b0099c7a812a895751df5e07">Handle</a>(<span class="stringliteral">&quot;Failed while trying to add or update an item from Outlook to CRM&quot;</span>, ex);</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                        syncState.SetPending(<span class="keyword">true</span>);</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;                    }</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;                    <span class="keywordflow">finally</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                    {</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;                        SaveItem(olItem);</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;                    }</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                }</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;            }</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;            <span class="keywordflow">return</span> result;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        }</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        <span class="keyword">internal</span> <span class="keyword">abstract</span> <span class="keywordtype">string</span> GetOutlookEntryId(OutlookItemType olItem);</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        <span class="keyword">internal</span> <span class="keyword">abstract</span> OlSensitivity GetSensitivity(OutlookItemType olItem);</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;</div><div class="line"><a name="l00318"></a><span class="lineno"><a class="line" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a144c42ce6181fbb0cdfb85dd84c4c08b">  318</a></span>&#160;        <span class="keyword">internal</span> IEnumerable&lt;WithRemovableSynchronisationProperties&gt; <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a144c42ce6181fbb0cdfb85dd84c4c08b">GetSynchronisedItems</a>()</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        {</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;            <span class="keywordflow">return</span> IsEnabled()</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;                ? <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager.html">SyncStateManager</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager.html#a449408102ad970c15d3df7641fafcab2">Instance</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager.html#af450f947df4fe310424ad2de1275d6cb">GetSynchronisedItems</a>&lt;SyncStateType&gt;()</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;                : <span class="keyword">new</span> List&lt;SyncStateType&gt;();</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        }</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;</div><div class="line"><a name="l00330"></a><span class="lineno"><a class="line" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#aca3f77307c81cf5192087bc033971373">  330</a></span>&#160;        <span class="keyword">internal</span> <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#aca3f77307c81cf5192087bc033971373">HandleItemMissingFromOutlook</a>(<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state.html">SyncState&lt;OutlookItemType&gt;</a> syncState)</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        {</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;            RemoveFromCrm(syncState);</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;            RemoveItemSyncState(syncState);</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        }</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;        <span class="keyword">internal</span> <span class="keyword">abstract</span> <span class="keywordtype">void</span> LogItemAction(OutlookItemType olItem, <span class="keywordtype">string</span> message);</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;</div><div class="line"><a name="l00347"></a><span class="lineno"><a class="line" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a3d0872dc57498d7b42f4fcf7a4652d6b">  347</a></span>&#160;        <span class="keyword">internal</span> <span class="keyword">override</span> <span class="keywordtype">void</span> <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a3d0872dc57498d7b42f4fcf7a4652d6b">PerformIteration</a>()</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        {</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;            <span class="keywordflow">if</span> (IsEnabled())</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;            {</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_direction.html">SyncDirection</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_direction.html#a96a16ea01111b3c05734e87d75eeef96">AllowInbound</a>(Direction))</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;                    SynchroniseAll();</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;                    Log.Debug($<span class="stringliteral">&quot;{GetType().Name}.SynchroniseAll not running because not enabled&quot;</span>);</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;                OtherIterationActions();</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;            }</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;            {</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                Log.Debug($<span class="stringliteral">&quot;{GetType().Name}.SynchroniseAll not running because no session&quot;</span>);</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;            }</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        }</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        <span class="keyword">protected</span> <span class="keyword">abstract</span> <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state.html">SyncState&lt;OutlookItemType&gt;</a> AddOrUpdateItemFromCrmToOutlook(MAPIFolder folder, <span class="keywordtype">string</span> crmType,</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;            <a class="code" href="class_suite_c_r_m_client_1_1_r_e_s_t_objects_1_1_entry_value.html">EntryValue</a> crmItem);</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;</div><div class="line"><a name="l00390"></a><span class="lineno"><a class="line" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a5eb280f891e9cd9ec9e31ed63da0a144">  390</a></span>&#160;        <span class="keyword">protected</span> <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a5eb280f891e9cd9ec9e31ed63da0a144">AddOrUpdateItemsFromCrmToOutlook</a>(</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;            IList&lt;EntryValue&gt; crmItems,</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;            MAPIFolder folder,</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;            HashSet&lt;<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state.html">SyncState&lt;OutlookItemType&gt;</a>&gt; untouched,</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;            <span class="keywordtype">string</span> crmType)</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;        {</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;            <span class="keywordflow">foreach</span> (var crmItem <span class="keywordflow">in</span> crmItems)</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;                <span class="keywordflow">try</span></div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;                {</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;                    <span class="keywordflow">if</span> (ShouldAddOrUpdateItemFromCrmToOutlook(folder, crmType, crmItem))</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                    {</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                        var state = AddOrUpdateItemFromCrmToOutlook(folder, crmType, crmItem);</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;                        <span class="keywordflow">if</span> (state != null)</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;                        {</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                            untouched.Remove(state);</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;                            <span class="comment">/* Because Outlook offers us back items in another thread as we modify them</span></div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="comment">                             * they may already be queued for output before we get here. But they should</span></div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="comment">                             * ideally not be sent, so we forcibly mark them as synced overriding the</span></div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;<span class="comment">                             * normal flow of the state transition engine. */</span></div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;                            state.SetSynced(<span class="keyword">true</span>);</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;                            LogItemAction(state.OutlookItem,</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                                <span class="stringliteral">&quot;Synchroniser.AddOrUpdateItemsFromCrmToOutlook, item removed from untouched&quot;</span>);</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;                        }</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;                    }</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                    <span class="keywordflow">else</span></div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;                    {</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;                        <span class="comment">/* even if we shouldn&#39;t update it, we should remove it from untouched. */</span></div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;                        untouched.Remove(<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager.html">SyncStateManager</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager.html#a449408102ad970c15d3df7641fafcab2">Instance</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager.html#a1be6c51a0b433eb8ae2ffa27f5cc1325">GetExistingSyncState</a>(crmItem) as SyncStateType);</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;                    }</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;                }</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;                <span class="keywordflow">catch</span> (<a class="code" href="namespace_exception.html">Exception</a> ex)</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;                {</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;                    <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_error_handler.html">ErrorHandler</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_error_handler.html#aa5ac5699b0099c7a812a895751df5e07">Handle</a>($<span class="stringliteral">&quot;Failed while trying to add or update {DefaultCrmModule} from Outlook to CRM&quot;</span>,</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;                        ex);</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;                }</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;        }</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        <span class="keyword">protected</span> <span class="keyword">abstract</span> <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_crm_id.html">CrmId</a> ConstructAndDespatchCrmItem(<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state.html">SyncState&lt;OutlookItemType&gt;</a> syncState);</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;</div><div class="line"><a name="l00449"></a><span class="lineno"><a class="line" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a2a3bba05bc1eaf3c7d0aa367748fa4fa">  449</a></span>&#160;        <span class="keyword">protected</span> <span class="keywordtype">void</span> <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a2a3bba05bc1eaf3c7d0aa367748fa4fa">EnsureSynchronisationPropertiesForOutlookItem</a>(OutlookItemType olItem, <span class="keywordtype">string</span> modifiedDate,</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;            <span class="keywordtype">string</span> type, <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_crm_id.html">CrmId</a> entryId)</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;        {</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;            <span class="keywordflow">try</span></div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;            {</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;                EnsureSynchronisationPropertyForOutlookItem(olItem, <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager.html">SyncStateManager</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager.html#ac8238c928477c231d5b65bc8c6502048">ModifiedDatePropertyName</a>,</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;                    modifiedDate);</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;                EnsureSynchronisationPropertyForOutlookItem(olItem, <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager.html">SyncStateManager</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager.html#a5f95121280f723b8f933ef50542b13bb">TypePropertyName</a>, type);</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_crm_id.html">CrmId</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_crm_id.html#ae8a022a1d7034b495864a55ede1e0e72">IsValid</a>(entryId))</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;                {</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;                    EnsureSynchronisationPropertyForOutlookItem(olItem, <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager.html">SyncStateManager</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager.html#af0d4d3f7b3761a69932991160d62d2e1">CrmIdPropertyName</a>, entryId);</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;                    <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager.html">SyncStateManager</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager.html#a449408102ad970c15d3df7641fafcab2">Instance</a>.SetByCrmId(entryId,</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;                        <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager.html">SyncStateManager</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager.html#a449408102ad970c15d3df7641fafcab2">Instance</a>.GetOrCreateSyncState(olItem));</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;                }</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;                EnsureSynchronisationPropertyForOutlookItem(olItem, <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager.html">SyncStateManager</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager.html#ac8238c928477c231d5b65bc8c6502048">ModifiedDatePropertyName</a>,</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;                    modifiedDate);</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;                EnsureSynchronisationPropertyForOutlookItem(olItem, <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager.html">SyncStateManager</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager.html#a5f95121280f723b8f933ef50542b13bb">TypePropertyName</a>, type);</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;            }</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;            <span class="keywordflow">catch</span> (<a class="code" href="namespace_exception.html">Exception</a> any)</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;            {</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;                Log.Warn($<span class="stringliteral">&quot;Unexpected error in EnsureSynchronisationPropertiesForOutlookItem&quot;</span>, any);</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;            }</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;            <span class="keywordflow">finally</span></div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;            {</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;                SaveItem(olItem);</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;            }</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;        }</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;</div><div class="line"><a name="l00484"></a><span class="lineno"><a class="line" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#af24b68dc7fefb15951248653ef8129d4">  484</a></span>&#160;        <span class="keyword">protected</span> <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#af24b68dc7fefb15951248653ef8129d4">EnsureSynchronisationPropertiesForOutlookItem</a>(OutlookItemType olItem, <a class="code" href="class_suite_c_r_m_client_1_1_r_e_s_t_objects_1_1_entry_value.html">EntryValue</a> crmItem)</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;        {</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;            EnsureSynchronisationPropertiesForOutlookItem(</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;                olItem,</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;                crmItem,</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;                DefaultCrmModule);</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;        }</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;</div><div class="line"><a name="l00498"></a><span class="lineno"><a class="line" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a05108367e2ac92ea2c33b4bffc221662">  498</a></span>&#160;        <span class="keyword">protected</span> <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a05108367e2ac92ea2c33b4bffc221662">EnsureSynchronisationPropertiesForOutlookItem</a>(OutlookItemType olItem, <a class="code" href="class_suite_c_r_m_client_1_1_r_e_s_t_objects_1_1_entry_value.html">EntryValue</a> crmItem,</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;            <span class="keywordtype">string</span> type)</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        {</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;            EnsureSynchronisationPropertiesForOutlookItem(</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;                olItem,</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;                crmItem.<a class="code" href="class_suite_c_r_m_client_1_1_r_e_s_t_objects_1_1_entry_value.html#a6ff81b41c04d9c891efbafabc25f335f">GetValueAsString</a>(<span class="stringliteral">&quot;date_modified&quot;</span>),</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;                type,</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;                <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_crm_id.html">CrmId</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_crm_id.html#a4c42d534f0f83aa65403c2c8e06dc5d1">Get</a>(crmItem.<a class="code" href="class_suite_c_r_m_client_1_1_r_e_s_t_objects_1_1_entry_value.html#a3bcbb05c30ef99a0d6bfca89345e11cc">id</a>));</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;        }</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;</div><div class="line"><a name="l00518"></a><span class="lineno"><a class="line" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#ae8232f960832e22b0c8063340a297a3f">  518</a></span>&#160;        <span class="keyword">protected</span> <span class="keywordtype">void</span> <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#ae8232f960832e22b0c8063340a297a3f">EnsureSynchronisationPropertiesForOutlookItem</a>(OutlookItemType olItem, DateTime modifiedDate,</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;            <span class="keywordtype">string</span> type, <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_crm_id.html">CrmId</a> entryId)</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;        {</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;            EnsureSynchronisationPropertiesForOutlookItem(olItem, modifiedDate.ToString(<span class="stringliteral">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>), type,</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;                entryId);</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;        }</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;        <span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keywordtype">void</span> EnsureSynchronisationPropertyForOutlookItem(OutlookItemType olItem, <span class="keywordtype">string</span> name,</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;            <span class="keywordtype">string</span> value);</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;</div><div class="line"><a name="l00534"></a><span class="lineno"><a class="line" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a9f9e083b51bdf10fd1236a4d34e3fad2">  534</a></span>&#160;        <span class="keyword">protected</span> <span class="keywordtype">void</span> <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a9f9e083b51bdf10fd1236a4d34e3fad2">EnsureSynchronisationPropertyForOutlookItem</a>(OutlookItemType olItem, <span class="keywordtype">string</span> name, <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_crm_id.html">CrmId</a> value)</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;        {</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;            EnsureSynchronisationPropertyForOutlookItem(olItem, name, value.<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_crm_id.html#ae39696f7859e5917afcba56aefeca1d1">ToString</a>());</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;        }</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;</div><div class="line"><a name="l00544"></a><span class="lineno"><a class="line" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a1cc49b75450a21630b653286b3743514">  544</a></span>&#160;        <span class="keyword">protected</span> List&lt;SyncState&lt;OutlookItemType&gt;&gt; <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a1cc49b75450a21630b653286b3743514">FindMatches</a>(<a class="code" href="class_suite_c_r_m_client_1_1_r_e_s_t_objects_1_1_entry_value.html">EntryValue</a> crmItem)</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;        {</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;            List&lt;SyncState&lt;OutlookItemType&gt;&gt; result;</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;            <span class="keywordflow">try</span></div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;            {</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;                result = <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager.html">SyncStateManager</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager.html#a449408102ad970c15d3df7641fafcab2">Instance</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager.html#af450f947df4fe310424ad2de1275d6cb">GetSynchronisedItems</a>&lt;<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state.html">SyncState&lt;OutlookItemType&gt;</a>&gt;()</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;                    .Where(a =&gt; a.VerifyItem() &amp;&amp; IsMatch(a.OutlookItem, crmItem))</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;                    .ToList();</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;            }</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;            <span class="keywordflow">catch</span> (<a class="code" href="namespace_exception.html">Exception</a> any)</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;            {</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;                <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_error_handler.html">ErrorHandler</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_error_handler.html#aa5ac5699b0099c7a812a895751df5e07">Handle</a>($<span class="stringliteral">&quot;Failure while checking for items matching id &#39;{crmItem.id}&#39; {Environment.NewLine}&quot;</span>, any);</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;                result = <span class="keyword">new</span> List&lt;SyncState&lt;OutlookItemType&gt;&gt;();</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;            }</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;            <span class="keywordflow">return</span> result;</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;        }</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;        <span class="keyword">protected</span> <span class="keyword">abstract</span> <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_crm_id.html">CrmId</a> GetCrmEntryId(OutlookItemType olItem);</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;</div><div class="line"><a name="l00575"></a><span class="lineno"><a class="line" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a1c05eaaf56c04964c20bc731c87c085b">  575</a></span>&#160;        <span class="keyword">protected</span> <span class="keyword">virtual</span> <a class="code" href="class_suite_c_r_m_client_1_1_r_e_s_t_objects_1_1_entry_list.html">EntryList</a> <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a1c05eaaf56c04964c20bc731c87c085b">GetEntriesPage</a>(<span class="keywordtype">int</span> offset)</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;        {</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="class_suite_c_r_m_client_1_1_rest_a_p_i_wrapper.html">RestAPIWrapper</a>.<a class="code" href="class_suite_c_r_m_client_1_1_rest_a_p_i_wrapper.html#a5822333b659d878ccd356ddcd28d466b">GetEntryList</a>(DefaultCrmModule,</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;                <span class="keywordtype">string</span>.Format(fetchQueryPrefix, <a class="code" href="class_suite_c_r_m_client_1_1_rest_a_p_i_wrapper.html">RestAPIWrapper</a>.<a class="code" href="class_suite_c_r_m_client_1_1_rest_a_p_i_wrapper.html#ab65492277e036bce9aff5361e64cb8fc">GetUserId</a>()),</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;                <a class="code" href="class_suite_c_r_m_add_in_1_1_properties_1_1_settings.html">Settings</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_properties_1_1_settings.html#a906a8cf6ad39360af6fcb416ada8068c">Default</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_properties_1_1_settings.html#a8e51bc530341ca80c3d0f787cfcae1c8">SyncMaxRecords</a>, <span class="stringliteral">&quot;date_start DESC&quot;</span>, offset, <span class="keyword">false</span>,</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;                <a class="code" href="class_suite_c_r_m_client_1_1_rest_a_p_i_wrapper.html">RestAPIWrapper</a>.<a class="code" href="class_suite_c_r_m_client_1_1_rest_a_p_i_wrapper.html#a322f04a8f26c73e5e43181a041c48c27">GetSugarFields</a>(DefaultCrmModule));</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;        }</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;</div><div class="line"><a name="l00587"></a><span class="lineno"><a class="line" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#aedc3c8d2603bec8fb24ce2b9c4395772">  587</a></span>&#160;        <span class="keyword">protected</span> <span class="keywordtype">bool</span> <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#aedc3c8d2603bec8fb24ce2b9c4395772">HasImportAccess</a>()</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;        {</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;            <span class="keywordflow">return</span> permissionsCache.HasImportAccess(DefaultCrmModule);</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;        }</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;</div><div class="line"><a name="l00592"></a><span class="lineno"><a class="line" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a3ef5ce830f6497db23adc6ca5410aa41">  592</a></span>&#160;        <span class="keyword">protected</span> <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a3ef5ce830f6497db23adc6ca5410aa41">InstallEventHandlers</a>()</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;        {</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;            <span class="keywordflow">if</span> (_itemsCollection == null)</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;            {</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;                var folder = GetDefaultFolder();</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;                _itemsCollection = folder.Items;</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;                folderName = folder.Name;</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;                Log.Debug(<span class="stringliteral">&quot;Adding event handlers for folder &quot;</span> + folderName);</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;                _itemsCollection.ItemAdd += Items_ItemAdd;</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;                _itemsCollection.ItemChange += Items_ItemChange;</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;                _itemsCollection.ItemRemove += Items_ItemRemove;</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;            }</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;        }</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;        <span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keywordtype">bool</span> IsMatch(OutlookItemType olItem, <a class="code" href="class_suite_c_r_m_client_1_1_r_e_s_t_objects_1_1_entry_value.html">EntryValue</a> crmItem);</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;</div><div class="line"><a name="l00617"></a><span class="lineno"><a class="line" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a1607be610d388bff188e5416143f2d80">  617</a></span>&#160;        <span class="keyword">protected</span> <span class="keywordtype">void</span> <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a1607be610d388bff188e5416143f2d80">Items_ItemAdd</a>(<span class="keywordtype">object</span> olItem)</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;        {</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;            Log.Warn($<span class="stringliteral">&quot;Outlook {folderName} ItemAdd&quot;</span>);</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;            <span class="keywordflow">try</span></div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;            {</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;                OutlookItemAdded(olItem as OutlookItemType);</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;            }</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;            <span class="keywordflow">catch</span> (<a class="code" href="namespace_exception.html">Exception</a> problem)</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;            {</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;                <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_error_handler.html">ErrorHandler</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_error_handler.html#aa5ac5699b0099c7a812a895751df5e07">Handle</a>($<span class="stringliteral">&quot;Failed to handle an item added to {folderName}&quot;</span>, problem);</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;            }</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;        }</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;</div><div class="line"><a name="l00630"></a><span class="lineno"><a class="line" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a810c422c6b3427bfe7b4c30f17cda22e">  630</a></span>&#160;        <span class="keyword">protected</span> <span class="keywordtype">void</span> <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a810c422c6b3427bfe7b4c30f17cda22e">Items_ItemChange</a>(<span class="keywordtype">object</span> olItem)</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;        {</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;            Log.Debug($<span class="stringliteral">&quot;Outlook {folderName} ItemChange&quot;</span>);</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;            <span class="keywordflow">try</span></div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;            {</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;                OutlookItemChanged(olItem as OutlookItemType);</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;            }</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;            <span class="keywordflow">catch</span> (<a class="code" href="namespace_exception.html">Exception</a> ex) when (ex is InvalidComObjectException || ex is COMException)</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;            {</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;                <span class="comment">// invalid item passed into Items_ItemChange, which is odd and </span></div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;                <span class="comment">// worrying but not much we can do.</span></div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;                Log.Debug(<span class="stringliteral">&quot;invalid item passed into Items_ItemChange&quot;</span>);</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;            }</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;            <span class="keywordflow">catch</span> (<a class="code" href="namespace_exception.html">Exception</a> problem)</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;            {</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;                <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_error_handler.html">ErrorHandler</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_error_handler.html#aa5ac5699b0099c7a812a895751df5e07">Handle</a>($<span class="stringliteral">&quot;Failed to handle an item modified in {folderName}&quot;</span>, problem);</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;            }</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;        }</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;</div><div class="line"><a name="l00649"></a><span class="lineno"><a class="line" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a7d45b163936a827d497ad7083f098bff">  649</a></span>&#160;        <span class="keyword">protected</span> <span class="keywordtype">void</span> <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a7d45b163936a827d497ad7083f098bff">Items_ItemRemove</a>()</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;        {</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;            Log.Debug($<span class="stringliteral">&quot;Outlook {folderName} ItemRemove: entry&quot;</span>);</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;            <span class="keywordflow">try</span></div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;            {</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;                RemoveDeletedItems();</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;            }</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;            <span class="keywordflow">catch</span> (<a class="code" href="namespace_exception.html">Exception</a> problem)</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;            {</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;                <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_error_handler.html">ErrorHandler</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_error_handler.html#aa5ac5699b0099c7a812a895751df5e07">Handle</a>($<span class="stringliteral">&quot;Failed to handle item(s) removed from {folderName}&quot;</span>, problem);</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;            }</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;            Log.Debug($<span class="stringliteral">&quot;Outlook {folderName} ItemRemove: exit&quot;</span>);</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;        }</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;</div><div class="line"><a name="l00669"></a><span class="lineno"><a class="line" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a19871d95386a55fdb513f3e80c1fb595">  669</a></span>&#160;        <span class="keyword">protected</span> <span class="keyword">virtual</span> IList&lt;EntryValue&gt; <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a19871d95386a55fdb513f3e80c1fb595">MergeRecordsFromCrm</a>(MAPIFolder folder, <span class="keywordtype">string</span> crmModule,</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;            HashSet&lt;<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state.html">SyncState&lt;OutlookItemType&gt;</a>&gt; untouched)</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;        {</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;            var thisOffset = 0; <span class="comment">// offset of current page of entries</span></div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;            var nextOffset = 0; <span class="comment">// offset of the next page of entries, if any.</span></div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;            var result = <span class="keyword">new</span> List&lt;EntryValue&gt;();</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;            <span class="comment">/* get candidates for syncrhonisation from SuiteCRM one page at a time */</span></div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;            <span class="keywordflow">do</span></div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;            {</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;                <span class="comment">/* update the offset to the offset of the next page */</span></div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;                thisOffset = nextOffset;</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;                var entriesPage = GetEntriesPage(thisOffset);</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;                var entryList = entriesPage.entry_list;</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;                <span class="comment">/* get the offset of the next page */</span></div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;                nextOffset = entriesPage.next_offset;</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;                <span class="keywordflow">if</span> (entryList != null &amp;&amp; entryList.Length &gt; 0)</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;                {</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;                    <span class="comment">/* it should not be, but it has happened that entry_list has been null */</span></div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;                    result.AddRange(entryList);</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;                }</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;            }</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;            <span class="comment">/* when there are no more entries, we&#39;ll get a zero-length entry list and nextOffset</span></div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;<span class="comment">             * will have the same value as thisOffset */</span></div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;            <span class="keywordflow">while</span> (thisOffset != nextOffset);</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;            <span class="keywordflow">return</span> result;</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;        }</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;</div><div class="line"><a name="l00704"></a><span class="lineno"><a class="line" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#ad2196ee3b0886b52f6825be9512147b8">  704</a></span>&#160;        <span class="keyword">protected</span> <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#ad2196ee3b0886b52f6825be9512147b8">OtherIterationActions</a>()</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;        {</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;            <span class="comment">// by default do nothing</span></div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;        }</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;</div><div class="line"><a name="l00715"></a><span class="lineno"><a class="line" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a72ed36f54393807d16215fbf6f1d6bc5">  715</a></span>&#160;        <span class="keyword">protected</span> <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a72ed36f54393807d16215fbf6f1d6bc5">OutlookItemAdded</a>(OutlookItemType olItem)</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;        {</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="class_suite_c_r_m_add_in_1_1_globals.html">Globals</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_globals.html#a7003a84165898c49d89498f9bd9659c5">ThisAddIn</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_this_add_in.html#aff2091c03ba97186e5d01f74806bd63a">IsLicensed</a>)</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;                <span class="keywordflow">try</span></div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;                {</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;                    OutlookItemAdded(olItem, <span class="keyword">this</span>);</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;                }</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;                <span class="keywordflow">catch</span> (<a class="code" href="namespace_exception.html">Exception</a> any)</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;                {</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;                    Log.Warn($<span class="stringliteral">&quot;Unexpected error in OutlookItemAdded&quot;</span>, any);</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;                }</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;                <span class="keywordflow">finally</span></div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;                {</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;                    <span class="keywordflow">if</span> (olItem != null)</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;                        SaveItem(olItem);</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;                }</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;                Log.Warn(</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;                    $<span class="stringliteral">&quot;Synchroniser.OutlookItemAdded: item {GetOutlookEntryId(olItem)} not added because not licensed&quot;</span>);</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;        }</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;</div><div class="line"><a name="l00742"></a><span class="lineno"><a class="line" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a3e3e99a7c7cba55e9cf586a59e9aadb9">  742</a></span>&#160;        <span class="keyword">protected</span> <span class="keywordtype">void</span> OutlookItemAdded&lt;T&gt;(OutlookItemType olItem, <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html">Synchroniser&lt;OutlookItemType, T&gt;</a> synchroniser)</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;            where T : <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state.html">SyncState&lt;OutlookItemType&gt;</a></div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;        {</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;            LogItemAction(olItem, $<span class="stringliteral">&quot;{GetType().Name}.OutlookItemAdded: {GetOutlookEntryId(olItem)}&quot;</span>);</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;            {</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;                lock (enqueueingLock)</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;                {</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager.html">SyncStateManager</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager.html#a449408102ad970c15d3df7641fafcab2">Instance</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager.html#a1be6c51a0b433eb8ae2ffa27f5cc1325">GetExistingSyncState</a>(olItem) == null)</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;                    {</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;                        var state = <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager.html">SyncStateManager</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager.html#a449408102ad970c15d3df7641fafcab2">Instance</a>.GetOrCreateSyncState(olItem) as T;</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;                        <span class="keywordflow">if</span> (state != null)</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;                        {</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;                            <span class="keywordflow">if</span> (olItem != null &amp;&amp; ShouldAddOrUpdateItemFromOutlookToCrm(olItem))</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;                                <a class="code" href="class_suite_c_r_m_add_in_1_1_daemon_1_1_daemon_worker.html">DaemonWorker</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_daemon_1_1_daemon_worker.html#a7cd50a597c99ce8c1167eee208224e37">Instance</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_daemon_1_1_daemon_worker.html#a759291681be3f2fd27ee7e82f0547fb6">AddTask</a>(</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;                                    <span class="keyword">new</span> <a class="code" href="class_suite_c_r_m_add_in_1_1_daemon_1_1_transmit_new_action.html">TransmitNewAction&lt;OutlookItemType, T&gt;</a>(synchroniser, state));</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;                        }</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;                        <span class="keywordflow">else</span></div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;                        {</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;                            Log.Warn(<span class="stringliteral">&quot;Should never happen: unexpected sync state type&quot;</span>);</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;                        }</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;                    }</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;                    <span class="keywordflow">else</span></div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;                    {</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;                        Log.Warn(</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;                            $<span class="stringliteral">&quot;{GetType().Name}.OutlookItemAdded: item {GetOutlookEntryId(olItem)} had already been added&quot;</span>);</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;                    }</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;                }</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;            }</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;        }</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;</div><div class="line"><a name="l00778"></a><span class="lineno"><a class="line" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a2aeb99cfaef929cf8593531566b1c5c0">  778</a></span>&#160;        <span class="keyword">protected</span> <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a2aeb99cfaef929cf8593531566b1c5c0">OutlookItemChanged</a>(OutlookItemType olItem)</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;        {</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="class_suite_c_r_m_add_in_1_1_globals.html">Globals</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_globals.html#a7003a84165898c49d89498f9bd9659c5">ThisAddIn</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_this_add_in.html#aff2091c03ba97186e5d01f74806bd63a">IsLicensed</a>)</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;                <span class="keywordflow">try</span></div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;                {</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;                    OutlookItemChanged(olItem, <span class="keyword">this</span>);</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;                }</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;                <span class="keywordflow">catch</span> (<a class="code" href="class_suite_c_r_m_add_in_1_1_exceptions_1_1_bad_state_transition.html">BadStateTransition</a> bst)</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;                {</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;                    <span class="keywordflow">if</span> (bst.<a class="code" href="class_suite_c_r_m_add_in_1_1_exceptions_1_1_bad_state_transition.html#a1479efcb8b54c404c2c2c646818d3525">From</a> != <a class="code" href="namespace_suite_c_r_m_add_in_1_1_business_logic.html#a46e26c41850a74036449e03576981875">TransmissionState</a>.Transmitted)</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;                        <span class="keywordflow">throw</span>;</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;                    <span class="comment">/* couldn&#39;t set pending -&gt; transmission is in progress */</span></div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;                }</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;                <span class="keywordflow">finally</span></div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;                {</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;                    SaveItem(olItem);</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;                }</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;                Log.Warn(</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;                    $<span class="stringliteral">&quot;Synchroniser.OutlookItemAdded: item {GetOutlookEntryId(olItem)} not updated because not licensed&quot;</span>);</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;        }</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;</div><div class="line"><a name="l00806"></a><span class="lineno"><a class="line" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a1366f80f9b7b2dddbd753bd8f8eab32f">  806</a></span>&#160;        <span class="keyword">protected</span> <span class="keywordtype">void</span> OutlookItemChanged&lt;T&gt;(OutlookItemType olItem, <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html">Synchroniser&lt;OutlookItemType, T&gt;</a> synchroniser)</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;            where T : <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state.html">SyncState&lt;OutlookItemType&gt;</a></div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;        {</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;            LogItemAction(olItem, $<span class="stringliteral">&quot;{GetType().Name}.OutlookItemChanged: {GetOutlookEntryId(olItem)}&quot;</span>);</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;            <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state.html">SyncState</a> state = <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager.html">SyncStateManager</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager.html#a449408102ad970c15d3df7641fafcab2">Instance</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager.html#a1be6c51a0b433eb8ae2ffa27f5cc1325">GetExistingSyncState</a>(olItem);</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;            var syncStateForItem = state as T;</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;            <span class="keywordflow">if</span> (syncStateForItem != null)</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;                <span class="keywordflow">try</span></div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;                {</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;                    syncStateForItem.SetPending();</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;                    <span class="keywordflow">if</span> (ShouldPerformSyncNow(syncStateForItem))</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;                        <a class="code" href="class_suite_c_r_m_add_in_1_1_daemon_1_1_daemon_worker.html">DaemonWorker</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_daemon_1_1_daemon_worker.html#a7cd50a597c99ce8c1167eee208224e37">Instance</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_daemon_1_1_daemon_worker.html#a759291681be3f2fd27ee7e82f0547fb6">AddTask</a>(</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;                            <span class="keyword">new</span> <a class="code" href="class_suite_c_r_m_add_in_1_1_daemon_1_1_transmit_update_action.html">TransmitUpdateAction&lt;OutlookItemType, T&gt;</a>(synchroniser, syncStateForItem));</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!syncStateForItem.ShouldSyncWithCrm)</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;                        RemoveFromCrm(syncStateForItem);</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;                }</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;                <span class="keywordflow">catch</span> (<a class="code" href="class_suite_c_r_m_add_in_1_1_exceptions_1_1_bad_state_transition.html">BadStateTransition</a> bst)</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;                {</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;                    <span class="keywordflow">if</span> (bst.<a class="code" href="class_suite_c_r_m_add_in_1_1_exceptions_1_1_bad_state_transition.html#a1479efcb8b54c404c2c2c646818d3525">From</a> != <a class="code" href="namespace_suite_c_r_m_add_in_1_1_business_logic.html#a46e26c41850a74036449e03576981875">TransmissionState</a>.Transmitted)</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;                        <span class="keywordflow">throw</span>;</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;                }</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;                OutlookItemAdded(olItem);</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;        }</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;</div><div class="line"><a name="l00844"></a><span class="lineno"><a class="line" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a7ac032a9c314f1d9f9d21050c88fad03">  844</a></span>&#160;        <span class="keyword">protected</span> DateTime <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a7ac032a9c314f1d9f9d21050c88fad03">ParseDateTimeFromUserProperty</a>(<span class="keywordtype">string</span> propertyValue)</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;        {</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;            <span class="keywordflow">if</span> (propertyValue == null) <span class="keywordflow">return</span> <span class="keywordflow">default</span>(DateTime);</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;            var modDateTime = DateTime.UtcNow;</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;            <span class="keywordflow">if</span> (!DateTime.TryParseExact(propertyValue, <span class="stringliteral">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>, null, DateTimeStyles.None,</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;                out modDateTime))</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;                DateTime.TryParse(propertyValue, out modDateTime);</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;            <span class="keywordflow">return</span> modDateTime;</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;        }</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;</div><div class="line"><a name="l00857"></a><span class="lineno"><a class="line" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a57e4fb41a00d48f5ef683b694763473b">  857</a></span>&#160;        <span class="keyword">protected</span> <span class="keywordtype">void</span> <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a57e4fb41a00d48f5ef683b694763473b">RemoveDeletedItems</a>()</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;        {</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;            <span class="comment">// Make a copy of the list to avoid mutation error while iterating:</span></div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;            var syncStatesCopy = <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager.html">SyncStateManager</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager.html#a449408102ad970c15d3df7641fafcab2">Instance</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager.html#af450f947df4fe310424ad2de1275d6cb">GetSynchronisedItems</a>&lt;SyncStateType&gt;();</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;            <span class="keywordflow">foreach</span> (var syncState <span class="keywordflow">in</span> syncStatesCopy)</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;            {</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;                var shouldDeleteFromCrm = this.IsEnabled() &amp;&amp;</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;                    <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_direction.html">SyncDirection</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_direction.html#ad456cb19bab5eb78bc35f7b305274d01">AllowOutbound</a>(this.Direction) &amp;&amp; </div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;                    (syncState.IsDeletedInOutlook || !syncState.VerifyItem() || !syncState.ShouldSyncWithCrm);</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;                <span class="keywordflow">if</span> (shouldDeleteFromCrm) RemoveFromCrm(syncState);</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;                <span class="keywordflow">if</span> (syncState.IsDeletedInOutlook) <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager.html">SyncStateManager</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager.html#a449408102ad970c15d3df7641fafcab2">Instance</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager.html#ab822ec09626e62fba91fe67405875c4b">RemoveSyncState</a>(syncState);</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;            }</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;        }</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;</div><div class="line"><a name="l00871"></a><span class="lineno"><a class="line" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#aac406ef7aa726441dda72708d1f28506">  871</a></span>&#160;        <span class="keyword">protected</span> <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#aac406ef7aa726441dda72708d1f28506">RemoveEventHandlers</a>()</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;        {</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;            <span class="keywordflow">if</span> (_itemsCollection != null)</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;            {</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;                Log.Debug(<span class="stringliteral">&quot;Removing event handlers for folder &quot;</span> + folderName);</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;                _itemsCollection.ItemAdd -= Items_ItemAdd;</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;                _itemsCollection.ItemChange -= Items_ItemChange;</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;                _itemsCollection.ItemRemove -= Items_ItemRemove;</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;                _itemsCollection = null;</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;            }</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;        }</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;</div><div class="line"><a name="l00887"></a><span class="lineno"><a class="line" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#addd935fc45782a1f55cc1904cef7b4c0">  887</a></span>&#160;        <span class="keyword">protected</span> <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#addd935fc45782a1f55cc1904cef7b4c0">RemoveFromCrm</a>(<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state.html">SyncState</a> state)</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;        {</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_direction.html">SyncDirection</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_direction.html#ad456cb19bab5eb78bc35f7b305274d01">AllowOutbound</a>(Direction))</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;            {</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;                var crmEntryId = state.CrmEntryId;</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;                <span class="keywordflow">if</span> (state.ExistedInCrm &amp;&amp; permissionsCache.HasImportAccess(state.CrmType))</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;                {</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;                    var data = <span class="keyword">new</span> <a class="code" href="class_suite_c_r_m_client_1_1_r_e_s_t_objects_1_1_name_value.html">NameValue</a>[2];</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;                    data[0] = <a class="code" href="class_suite_c_r_m_client_1_1_rest_a_p_i_wrapper.html">RestAPIWrapper</a>.<a class="code" href="class_suite_c_r_m_client_1_1_rest_a_p_i_wrapper.html#a7d8a3f489c3f14462f6a6732939e95be">SetNameValuePair</a>(<span class="stringliteral">&quot;id&quot;</span>, crmEntryId);</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;                    data[1] = <a class="code" href="class_suite_c_r_m_client_1_1_rest_a_p_i_wrapper.html">RestAPIWrapper</a>.<a class="code" href="class_suite_c_r_m_client_1_1_rest_a_p_i_wrapper.html#a7d8a3f489c3f14462f6a6732939e95be">SetNameValuePair</a>(<span class="stringliteral">&quot;deleted&quot;</span>, <span class="stringliteral">&quot;1&quot;</span>);</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;                    <a class="code" href="class_suite_c_r_m_client_1_1_rest_a_p_i_wrapper.html">RestAPIWrapper</a>.<a class="code" href="class_suite_c_r_m_client_1_1_rest_a_p_i_wrapper.html#ad68d42762e45541a293986a208c20656">SetEntry</a>(data, state.CrmType);</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;                }</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;                state.RemoveCrmLink();</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;            }</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;        }</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;</div><div class="line"><a name="l00908"></a><span class="lineno"><a class="line" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a45e51c5fe658ba1c5a6f8ddd87851023">  908</a></span>&#160;        <span class="keyword">protected</span> <span class="keywordtype">void</span> <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a45e51c5fe658ba1c5a6f8ddd87851023">RemoveItemAndSyncState</a>(<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state.html">SyncState&lt;OutlookItemType&gt;</a> syncState)</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;        {</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;            LogItemAction(syncState.OutlookItem, <span class="stringliteral">&quot;Synchroniser.RemoveItemAndSyncState, deleting item&quot;</span>);</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;            <span class="keywordflow">try</span></div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;            {</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;                syncState.DeleteItem();</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;            }</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;            <span class="keywordflow">catch</span> (<a class="code" href="namespace_exception.html">Exception</a> ex)</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;            {</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;                <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_error_handler.html">ErrorHandler</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_error_handler.html#aa5ac5699b0099c7a812a895751df5e07">Handle</a>($<span class="stringliteral">&quot;Failed while trying to delete a {DefaultCrmModule} item&quot;</span>, ex);</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;            }</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;            RemoveItemSyncState(syncState);</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;        }</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;</div><div class="line"><a name="l00926"></a><span class="lineno"><a class="line" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a2558c30177602138a43c9654c26f912d">  926</a></span>&#160;        <span class="keyword">protected</span> <span class="keywordtype">void</span> <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a2558c30177602138a43c9654c26f912d">RemoveItemSyncState</a>(<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state.html">SyncState&lt;OutlookItemType&gt;</a> item)</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;        {</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;            LogItemAction(item.OutlookItem, <span class="stringliteral">&quot;Synchroniser.RemoveItemSyncState, removed item from queue&quot;</span>);</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;            <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager.html">SyncStateManager</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager.html#a449408102ad970c15d3df7641fafcab2">Instance</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager.html#ab822ec09626e62fba91fe67405875c4b">RemoveSyncState</a>(item);</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;        }</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;</div><div class="line"><a name="l00937"></a><span class="lineno"><a class="line" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a2770863b6c4065b62d5fb72abd0927d3">  937</a></span>&#160;        <span class="keyword">protected</span> <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a2770863b6c4065b62d5fb72abd0927d3">ResolveUnmatchedItems</a>(IEnumerable&lt;<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state.html">SyncState&lt;OutlookItemType&gt;</a>&gt; itemsToResolve)</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;        {</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;            <span class="keywordflow">try</span></div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;            {</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;                <span class="keywordflow">foreach</span> (var unresolved <span class="keywordflow">in</span> itemsToResolve)</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;                    <span class="keywordflow">switch</span> (unresolved.TxState)</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;                    {</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;                        <span class="keywordflow">case</span> <a class="code" href="namespace_suite_c_r_m_add_in_1_1_business_logic.html#a46e26c41850a74036449e03576981875">TransmissionState</a>.PendingDeletion:</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;                            <span class="comment">/* If it&#39;s to resolve and marked pending deletion, we delete it</span></div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;<span class="comment">                             * (unresolved on two successive iterations): */</span></div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;                            RemoveItemAndSyncState(unresolved);</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;                            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;                        <span class="keywordflow">case</span> <a class="code" href="namespace_suite_c_r_m_add_in_1_1_business_logic.html#a46e26c41850a74036449e03576981875">TransmissionState</a>.Synced:</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;                            <span class="keywordflow">if</span> (unresolved.ExistedInCrm)</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;                                unresolved.SetPendingDeletion();</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;                            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;                        <span class="keywordflow">case</span> <a class="code" href="namespace_suite_c_r_m_add_in_1_1_business_logic.html#a46e26c41850a74036449e03576981875">TransmissionState</a>.Pending:</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;                        <span class="keywordflow">case</span> <a class="code" href="namespace_suite_c_r_m_add_in_1_1_business_logic.html#a46e26c41850a74036449e03576981875">TransmissionState</a>.PresentAtStartup:</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;                            <span class="keywordflow">if</span> (unresolved.ShouldSyncWithCrm)</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;                                <span class="keywordflow">try</span></div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;                                {</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;                                    <span class="comment">/* if it&#39;s unresolved, pending, and should be synced send it. */</span></div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;                                    unresolved.SetQueued();</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;                                    AddOrUpdateItemFromOutlookToCrm(unresolved);</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;                                }</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;                                <span class="keywordflow">catch</span> (<a class="code" href="class_suite_c_r_m_add_in_1_1_exceptions_1_1_bad_state_transition.html">BadStateTransition</a>)</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;                                {</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;                                    <span class="comment">// ignore.</span></div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;                                }</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;                            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;                        <span class="keywordflow">case</span> <a class="code" href="namespace_suite_c_r_m_add_in_1_1_business_logic.html#a46e26c41850a74036449e03576981875">TransmissionState</a>.Queued:</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;                            <span class="keywordflow">if</span> (unresolved.ShouldSyncWithCrm)</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;                                <span class="keywordflow">try</span></div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;                                {</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;                                    <span class="comment">/* if it&#39;s queued and should be synced send it. */</span></div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;                                    AddOrUpdateItemFromOutlookToCrm(unresolved);</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;                                }</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;                                <span class="keywordflow">catch</span> (<a class="code" href="class_suite_c_r_m_add_in_1_1_exceptions_1_1_bad_state_transition.html">BadStateTransition</a> bst)</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;                                {</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;                                    <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_error_handler.html">ErrorHandler</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_error_handler.html#aa5ac5699b0099c7a812a895751df5e07">Handle</a>($<span class="stringliteral">&quot;Failure while seeking to resolve unmatched items&quot;</span>, bst);</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;                                }</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;                            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;                        <span class="keywordflow">default</span>:</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;                            <span class="keywordflow">try</span></div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;                            {</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;                                unresolved.SetPending();</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;                            }</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;                            <span class="keywordflow">catch</span> (<a class="code" href="class_suite_c_r_m_add_in_1_1_exceptions_1_1_bad_state_transition.html">BadStateTransition</a> bst)</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;                            {</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;                                <span class="keywordflow">if</span> (bst.<a class="code" href="class_suite_c_r_m_add_in_1_1_exceptions_1_1_bad_state_transition.html#a1479efcb8b54c404c2c2c646818d3525">From</a> != <a class="code" href="namespace_suite_c_r_m_add_in_1_1_business_logic.html#a46e26c41850a74036449e03576981875">TransmissionState</a>.Transmitted)</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;                                    <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_error_handler.html">ErrorHandler</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_error_handler.html#aa5ac5699b0099c7a812a895751df5e07">Handle</a>($<span class="stringliteral">&quot;Failure while seeking to resolve unmatched items&quot;</span>, bst);</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;                            }</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;                            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;                    }</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;            }</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;            <span class="keywordflow">finally</span></div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;            {</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;                <span class="keywordflow">foreach</span> (<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state.html">SyncState</a> resolved <span class="keywordflow">in</span> <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager.html">SyncStateManager</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager.html#a449408102ad970c15d3df7641fafcab2">Instance</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager.html#af450f947df4fe310424ad2de1275d6cb">GetSynchronisedItems</a>&lt;SyncStateType&gt;()</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;                        .Where(s =&gt; s.TxState == <a class="code" href="namespace_suite_c_r_m_add_in_1_1_business_logic.html#a46e26c41850a74036449e03576981875">TransmissionState</a>.PendingDeletion &amp;&amp;</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;                                    !itemsToResolve.Contains(s)))</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;                    <span class="comment">/* finally, if there exists an item which had been marked pending deletion, but it has</span></div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;<span class="comment">                     *  been found in CRM (i.e. not in unresolved), mark it as synced */</span></div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;                    ((<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state.html">SyncState&lt;OutlookItemType&gt;</a>)resolved).SetSynced();</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;            }</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;        }</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;        <span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keywordtype">void</span> SaveItem(OutlookItemType olItem);</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;</div><div class="line"><a name="l01029"></a><span class="lineno"><a class="line" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a9083c41b17e06cc70f6148b53c132b45"> 1029</a></span>&#160;        <span class="keyword">protected</span> <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a9083c41b17e06cc70f6148b53c132b45">ShouldAddOrUpdateItemFromCrmToOutlook</a>(MAPIFolder folder, <span class="keywordtype">string</span> crmType,</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;            <a class="code" href="class_suite_c_r_m_client_1_1_r_e_s_t_objects_1_1_entry_value.html">EntryValue</a> crmItem)</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;        {</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;        }</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;</div><div class="line"><a name="l01047"></a><span class="lineno"><a class="line" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a0a1cef482073eb1582a339879e84d630"> 1047</a></span>&#160;        <span class="keyword">protected</span> <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a0a1cef482073eb1582a339879e84d630">ShouldAddOrUpdateItemFromOutlookToCrm</a>(OutlookItemType olItem)</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;        {</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;            <span class="keywordtype">bool</span> result;</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;            var prefix = <span class="stringliteral">&quot;Synchoniser.ShouldAddOrUpdateItemFromOutlookToCrm&quot;</span>;</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;            <span class="keywordflow">try</span></div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;            {</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;                <span class="keywordflow">if</span> (olItem == null)</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;                {</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;                    Log.Warn($<span class="stringliteral">&quot;{prefix}: attempt to send null to {DefaultCrmModule}?&quot;</span>);</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;                    result = <span class="keyword">false</span>;</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;                }</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;                {</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;                    <span class="keywordflow">if</span> (IsManualOverride(olItem))</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;                    {</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;                        Log.Info(</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;                            $<span class="stringliteral">&quot;{prefix}: {DefaultCrmModule} added to CRM because it is set to manual override.&quot;</span>);</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;                        result = <span class="keyword">true</span>;</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;                    }</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_direction.html">SyncDirection</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_direction.html#ad456cb19bab5eb78bc35f7b305274d01">AllowOutbound</a>(Direction))</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;                    {</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;                        <span class="keywordflow">if</span> (permissionsCache.HasImportAccess(DefaultCrmModule))</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;                        {</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;                            <span class="keywordflow">if</span> (GetSensitivity(olItem) == OlSensitivity.olNormal)</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;                            {</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;                                result = <span class="keyword">true</span>;</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;                            }</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;                            <span class="keywordflow">else</span></div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;                            {</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;                                Log.Info(</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;                                    $<span class="stringliteral">&quot;{prefix}: {DefaultCrmModule} not added to CRM because its sensitivity is not public.&quot;</span>);</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;                                result = <span class="keyword">false</span>;</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;                            }</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;                        }</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;                        <span class="keywordflow">else</span></div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;                        {</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;                            Log.Info(</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;                                $<span class="stringliteral">&quot;{prefix}: {DefaultCrmModule} not added to CRM because import access is not granted.&quot;</span>);</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;                            result = <span class="keyword">false</span>;</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;                        }</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;                    }</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;                    <span class="keywordflow">else</span></div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;                    {</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;                        Log.Info(</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;                            $<span class="stringliteral">&quot;{prefix}: {DefaultCrmModule} not added to CRM because synchronisation is not enabled.&quot;</span>);</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;                        result = <span class="keyword">false</span>;</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;                    }</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;                }</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;            }</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;            <span class="keywordflow">catch</span> (<a class="code" href="namespace_exception.html">Exception</a> any)</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;            {</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;                <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_error_handler.html">ErrorHandler</a>.<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_error_handler.html#aa5ac5699b0099c7a812a895751df5e07">Handle</a>($<span class="stringliteral">&quot;Unexpected failure while checking {DefaultCrmModule}.&quot;</span>, any);</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;                result = <span class="keyword">false</span>;</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;            }</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;            <span class="keywordflow">return</span> result;</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;        }</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;</div><div class="line"><a name="l01116"></a><span class="lineno"><a class="line" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a9c37b1a01f04b2b611f21b0059497b46"> 1116</a></span>&#160;        <span class="keyword">protected</span> <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a9c37b1a01f04b2b611f21b0059497b46">IsManualOverride</a>(OutlookItemType olItem)</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;        {</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;        }</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;</div><div class="line"><a name="l01127"></a><span class="lineno"><a class="line" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#aeba73872260cea816f85c963be323771"> 1127</a></span>&#160;        <span class="keyword">protected</span> <span class="keywordtype">bool</span> <a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#aeba73872260cea816f85c963be323771">ShouldPerformSyncNow</a>(<a class="code" href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state.html">SyncState&lt;OutlookItemType&gt;</a> syncState)</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;        {</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;            <span class="keywordflow">return</span> syncState.ShouldPerformSyncNow();</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;        }</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;        <span class="keyword">private</span> <span class="keywordtype">void</span> AddSuiteCrmOutlookCategory()</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;        {</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;            var oNS = Application.GetNamespace(<span class="stringliteral">&quot;mapi&quot;</span>);</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;            <span class="keywordflow">if</span> (oNS.Categories[<span class="stringliteral">&quot;SuiteCRM&quot;</span>] == null)</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;                oNS.Categories.Add(<span class="stringliteral">&quot;SuiteCRM&quot;</span>, OlCategoryColor.olCategoryColorGreen,</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;                    OlCategoryShortcutKey.olCategoryShortcutKeyNone);</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;        }</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;    }</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;}</div><div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_repeating_process_html"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_repeating_process.html">SuiteCRMAddIn.BusinessLogic.RepeatingProcess</a></div><div class="ttdoc">An agent which does something repeatedly. </div><div class="ttdef"><b>Definition:</b> <a href="_repeating_process_8cs_source.html#l00036">RepeatingProcess.cs:36</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser_html_a57e4fb41a00d48f5ef683b694763473b"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a57e4fb41a00d48f5ef683b694763473b">SuiteCRMAddIn.BusinessLogic.Synchroniser.RemoveDeletedItems</a></div><div class="ttdeci">void RemoveDeletedItems()</div><div class="ttdoc">Deal, in CRM, with items deleted in Outlook. </div><div class="ttdef"><b>Definition:</b> <a href="_synchroniser_8cs_source.html#l00857">Synchroniser.cs:857</a></div></div>
<div class="ttc" id="class_suite_c_r_m_client_1_1_rest_a_p_i_wrapper_html"><div class="ttname"><a href="class_suite_c_r_m_client_1_1_rest_a_p_i_wrapper.html">SuiteCRMClient.RestAPIWrapper</a></div><div class="ttdoc">A class which comprises wrappers for calls in the REST API, which return objects generally from the R...</div><div class="ttdef"><b>Definition:</b> <a href="_rest_a_p_i_wrapper_8cs_source.html#l00039">RestAPIWrapper.cs:39</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_crm_id_html_a4c42d534f0f83aa65403c2c8e06dc5d1"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_crm_id.html#a4c42d534f0f83aa65403c2c8e06dc5d1">SuiteCRMAddIn.BusinessLogic.CrmId.Get</a></div><div class="ttdeci">static CrmId Get(string value)</div><div class="ttdoc">Get the single CrmId instance for this value. </div><div class="ttdef"><b>Definition:</b> <a href="_crm_id_8cs_source.html#l00153">CrmId.cs:153</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser_html_a5eb280f891e9cd9ec9e31ed63da0a144"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a5eb280f891e9cd9ec9e31ed63da0a144">SuiteCRMAddIn.BusinessLogic.Synchroniser.AddOrUpdateItemsFromCrmToOutlook</a></div><div class="ttdeci">virtual void AddOrUpdateItemsFromCrmToOutlook(IList&lt; EntryValue &gt; crmItems, MAPIFolder folder, HashSet&lt; SyncState&lt; OutlookItemType &gt;&gt; untouched, string crmType)</div><div class="ttdoc">Update these items, which may or may not already exist in Outlook. </div><div class="ttdef"><b>Definition:</b> <a href="_synchroniser_8cs_source.html#l00390">Synchroniser.cs:390</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser_html_acf44d5faca57f157a7e50706eb4b28d2"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#acf44d5faca57f157a7e50706eb4b28d2">SuiteCRMAddIn.BusinessLogic.Synchroniser.GetStartDateString</a></div><div class="ttdeci">string GetStartDateString()</div><div class="ttdoc">Return a SQL fragment based on my start date </div><div class="ttdef"><b>Definition:</b> <a href="_synchroniser_8cs_source.html#l00187">Synchroniser.cs:187</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser_html_a3ef5ce830f6497db23adc6ca5410aa41"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a3ef5ce830f6497db23adc6ca5410aa41">SuiteCRMAddIn.BusinessLogic.Synchroniser.InstallEventHandlers</a></div><div class="ttdeci">virtual void InstallEventHandlers()</div><div class="ttdef"><b>Definition:</b> <a href="_synchroniser_8cs_source.html#l00592">Synchroniser.cs:592</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser_html_af24b68dc7fefb15951248653ef8129d4"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#af24b68dc7fefb15951248653ef8129d4">SuiteCRMAddIn.BusinessLogic.Synchroniser.EnsureSynchronisationPropertiesForOutlookItem</a></div><div class="ttdeci">virtual void EnsureSynchronisationPropertiesForOutlookItem(OutlookItemType olItem, EntryValue crmItem)</div><div class="ttdoc">Set up synchronisation properties for this outlook item from this CRM item, assuming my default CRM m...</div><div class="ttdef"><b>Definition:</b> <a href="_synchroniser_8cs_source.html#l00484">Synchroniser.cs:484</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_this_add_in_html_ac6234db8eca55ca418b5043365bfdec3"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_this_add_in.html#ac6234db8eca55ca418b5043365bfdec3">SuiteCRMAddIn.ThisAddIn.HasCrmUserSession</a></div><div class="ttdeci">bool HasCrmUserSession</div><div class="ttdef"><b>Definition:</b> <a href="_this_add_in_8cs_source.html#l00131">ThisAddIn.cs:131</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser_html_ad461e0df84105575ef48b4a994f06192"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#ad461e0df84105575ef48b4a994f06192">SuiteCRMAddIn.BusinessLogic.Synchroniser.Synchroniser</a></div><div class="ttdeci">Synchroniser(string name, SyncContext context)</div><div class="ttdef"><b>Definition:</b> <a href="_synchroniser_8cs_source.html#l00047">Synchroniser.cs:47</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser_html_a05108367e2ac92ea2c33b4bffc221662"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a05108367e2ac92ea2c33b4bffc221662">SuiteCRMAddIn.BusinessLogic.Synchroniser.EnsureSynchronisationPropertiesForOutlookItem</a></div><div class="ttdeci">virtual void EnsureSynchronisationPropertiesForOutlookItem(OutlookItemType olItem, EntryValue crmItem, string type)</div><div class="ttdoc">Set up synchronisation properties for this outlook item from this CRM item, assuming my default CRM m...</div><div class="ttdef"><b>Definition:</b> <a href="_synchroniser_8cs_source.html#l00498">Synchroniser.cs:498</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser_html_a0a1cef482073eb1582a339879e84d630"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a0a1cef482073eb1582a339879e84d630">SuiteCRMAddIn.BusinessLogic.Synchroniser.ShouldAddOrUpdateItemFromOutlookToCrm</a></div><div class="ttdeci">virtual bool ShouldAddOrUpdateItemFromOutlookToCrm(OutlookItemType olItem)</div><div class="ttdoc">Perform all the necessary checking before adding or updating an item on CRM. </div><div class="ttdef"><b>Definition:</b> <a href="_synchroniser_8cs_source.html#l01047">Synchroniser.cs:1047</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser_html_aaeeca4690fad8a84a4524658be17d7dc"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#aaeeca4690fad8a84a4524658be17d7dc">SuiteCRMAddIn.BusinessLogic.Synchroniser.IsEnabled</a></div><div class="ttdeci">bool IsEnabled()</div><div class="ttdoc">Am I enabled? I.e., am I able either to import or to export? </div><div class="ttdef"><b>Definition:</b> <a href="_synchroniser_8cs_source.html#l00166">Synchroniser.cs:166</a></div></div>
<div class="ttc" id="class_suite_c_r_m_client_1_1_rest_a_p_i_wrapper_html_ab65492277e036bce9aff5361e64cb8fc"><div class="ttname"><a href="class_suite_c_r_m_client_1_1_rest_a_p_i_wrapper.html#ab65492277e036bce9aff5361e64cb8fc">SuiteCRMClient.RestAPIWrapper.GetUserId</a></div><div class="ttdeci">static string GetUserId()</div><div class="ttdoc">Return the CRM id of the current user. </div><div class="ttdef"><b>Definition:</b> <a href="_rest_a_p_i_wrapper_8cs_source.html#l00170">RestAPIWrapper.cs:170</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser_html_a2558c30177602138a43c9654c26f912d"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a2558c30177602138a43c9654c26f912d">SuiteCRMAddIn.BusinessLogic.Synchroniser.RemoveItemSyncState</a></div><div class="ttdeci">void RemoveItemSyncState(SyncState&lt; OutlookItemType &gt; item)</div><div class="ttdoc">Remove an item from ItemsSyncState. </div><div class="ttdef"><b>Definition:</b> <a href="_synchroniser_8cs_source.html#l00926">Synchroniser.cs:926</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser_html_aedc3c8d2603bec8fb24ce2b9c4395772"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#aedc3c8d2603bec8fb24ce2b9c4395772">SuiteCRMAddIn.BusinessLogic.Synchroniser.HasImportAccess</a></div><div class="ttdeci">bool HasImportAccess()</div><div class="ttdoc">Check whether this synchroniser is allowed import access for its default CRM module. </div><div class="ttdef"><b>Definition:</b> <a href="_synchroniser_8cs_source.html#l00587">Synchroniser.cs:587</a></div></div>
<div class="ttc" id="namespace_system_html"><div class="ttname"><a href="namespace_system.html">System</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser_html_a3085a2b7a41e3b043d7cfa9160009e3c"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a3085a2b7a41e3b043d7cfa9160009e3c">SuiteCRMAddIn.BusinessLogic.Synchroniser.GetStartDate</a></div><div class="ttdeci">DateTime GetStartDate()</div><div class="ttdoc">Get a date stamp for midnight five days ago (why?). </div><div class="ttdef"><b>Definition:</b> <a href="_synchroniser_8cs_source.html#l00177">Synchroniser.cs:177</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser_html_a72ed36f54393807d16215fbf6f1d6bc5"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a72ed36f54393807d16215fbf6f1d6bc5">SuiteCRMAddIn.BusinessLogic.Synchroniser.OutlookItemAdded</a></div><div class="ttdeci">virtual void OutlookItemAdded(OutlookItemType olItem)</div><div class="ttdoc">Entry point from event handler when an item is added in Outlook. </div><div class="ttdef"><b>Definition:</b> <a href="_synchroniser_8cs_source.html#l00715">Synchroniser.cs:715</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser_html_a4038c28ad028c598dffb4e07920296d0"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a4038c28ad028c598dffb4e07920296d0">SuiteCRMAddIn.BusinessLogic.Synchroniser.fetchQueryPrefix</a></div><div class="ttdeci">string fetchQueryPrefix</div><div class="ttdoc">The prefix for the fetch query, used in FetchRecordsFromCrm, q.v. </div><div class="ttdef"><b>Definition:</b> <a href="_synchroniser_8cs_source.html#l00141">Synchroniser.cs:141</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_c_r_m_permissions_cache_html"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_c_r_m_permissions_cache.html">SuiteCRMAddIn.BusinessLogic.CRMPermissionsCache&lt; OutlookItemType, SyncStateType &gt;</a></div></div>
<div class="ttc" id="namespace_suite_c_r_m_add_in_1_1_exceptions_html"><div class="ttname"><a href="namespace_suite_c_r_m_add_in_1_1_exceptions.html">SuiteCRMAddIn.Exceptions</a></div><div class="ttdoc">The Exceptions package contains all custom exceptions used by the addin. </div><div class="ttdef"><b>Definition:</b> <a href="_action_disabled_exception_8cs_source.html#l00024">ActionDisabledException.cs:24</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser_html_ad2196ee3b0886b52f6825be9512147b8"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#ad2196ee3b0886b52f6825be9512147b8">SuiteCRMAddIn.BusinessLogic.Synchroniser.OtherIterationActions</a></div><div class="ttdeci">virtual void OtherIterationActions()</div><div class="ttdoc">A hook to allow specialisations to do something additional to just syncing in their iterations...</div><div class="ttdef"><b>Definition:</b> <a href="_synchroniser_8cs_source.html#l00704">Synchroniser.cs:704</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_direction_html_aee195368e938ed8e05fa3ec669838c06"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_direction.html#aee195368e938ed8e05fa3ec669838c06">SuiteCRMAddIn.BusinessLogic.SyncDirection.Direction</a></div><div class="ttdeci">Direction</div><div class="ttdoc">The actual directions </div><div class="ttdef"><b>Definition:</b> <a href="_sync_direction_8cs_source.html#l00034">SyncDirection.cs:34</a></div></div>
<div class="ttc" id="namespace_suite_c_r_m_client_1_1_logging_html"><div class="ttname"><a href="namespace_suite_c_r_m_client_1_1_logging.html">SuiteCRMClient.Logging</a></div><div class="ttdef"><b>Definition:</b> <a href="_abstract_logger_8cs_source.html#l00023">AbstractLogger.cs:23</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser_html_a78c2542df90d2227cbdf0a8729d592e4"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a78c2542df90d2227cbdf0a8729d592e4">SuiteCRMAddIn.BusinessLogic.Synchroniser.Synchroniser</a></div><div class="ttdeci">Synchroniser(string threadName, SyncContext context)</div><div class="ttdoc">Construct a new instance of a synchroniser with this thread name and context. </div><div class="ttdef"><b>Definition:</b> <a href="_synchroniser_8cs_source.html#l00150">Synchroniser.cs:150</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_properties_1_1_settings_html_a906a8cf6ad39360af6fcb416ada8068c"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_properties_1_1_settings.html#a906a8cf6ad39360af6fcb416ada8068c">SuiteCRMAddIn.Properties.Settings.Default</a></div><div class="ttdeci">static Settings Default</div><div class="ttdef"><b>Definition:</b> <a href="_suite_c_r_m_add_in_2_properties_2_settings_8_designer_8cs_source.html#l00020">Settings.Designer.cs:20</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser_html_a0de4a3f57b7174d19b7e44011a40a444"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a0de4a3f57b7174d19b7e44011a40a444">SuiteCRMAddIn.BusinessLogic.Synchroniser.PerformStartup</a></div><div class="ttdeci">override void PerformStartup()</div><div class="ttdoc">Specialisation: get my Outlook items. </div><div class="ttdef"><b>Definition:</b> <a href="_synchroniser_8cs_source.html#l00079">Synchroniser.cs:79</a></div></div>
<div class="ttc" id="namespace_exception_html"><div class="ttname"><a href="namespace_exception.html">Exception</a></div></div>
<div class="ttc" id="namespace_suite_c_r_m_client_1_1_r_e_s_t_objects_html"><div class="ttname"><a href="namespace_suite_c_r_m_client_1_1_r_e_s_t_objects.html">SuiteCRMClient.RESTObjects</a></div><div class="ttdoc">The RESTObjects package contains classes which may be deserialised from JSON messages sent by CRM...</div><div class="ttdef"><b>Definition:</b> <a href="_available_modules_8cs_source.html#l00023">AvailableModules.cs:23</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser_html_a1c05eaaf56c04964c20bc731c87c085b"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a1c05eaaf56c04964c20bc731c87c085b">SuiteCRMAddIn.BusinessLogic.Synchroniser.GetEntriesPage</a></div><div class="ttdeci">virtual EntryList GetEntriesPage(int offset)</div><div class="ttdoc">Fetch the page of entries from this module starting at this offset. </div><div class="ttdef"><b>Definition:</b> <a href="_synchroniser_8cs_source.html#l00575">Synchroniser.cs:575</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser_html_a2aeb99cfaef929cf8593531566b1c5c0"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a2aeb99cfaef929cf8593531566b1c5c0">SuiteCRMAddIn.BusinessLogic.Synchroniser.OutlookItemChanged</a></div><div class="ttdeci">virtual void OutlookItemChanged(OutlookItemType olItem)</div><div class="ttdoc">Entry point from event handler, called when an Outlook item of class AppointmentItem is believed to h...</div><div class="ttdef"><b>Definition:</b> <a href="_synchroniser_8cs_source.html#l00778">Synchroniser.cs:778</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager_html"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager.html">SuiteCRMAddIn.BusinessLogic.SyncStateManager</a></div><div class="ttdoc">One of the problems with the design of the add-in is that we&amp;#39;re trying to shim two types of CRM entit...</div><div class="ttdef"><b>Definition:</b> <a href="_sync_state_manager_8cs_source.html#l00048">SyncStateManager.cs:48</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_this_add_in_html_aff2091c03ba97186e5d01f74806bd63a"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_this_add_in.html#aff2091c03ba97186e5d01f74806bd63a">SuiteCRMAddIn.ThisAddIn.IsLicensed</a></div><div class="ttdeci">bool IsLicensed</div><div class="ttdoc">True if this is a licensed copy of the add-in. </div><div class="ttdef"><b>Definition:</b> <a href="_this_add_in_8cs_source.html#l01034">ThisAddIn.cs:1034</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager_html_a5f95121280f723b8f933ef50542b13bb"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager.html#a5f95121280f723b8f933ef50542b13bb">SuiteCRMAddIn.BusinessLogic.SyncStateManager.TypePropertyName</a></div><div class="ttdeci">const string TypePropertyName</div><div class="ttdoc">The name of the type synchronisation property. </div><div class="ttdef"><b>Definition:</b> <a href="_sync_state_manager_8cs_source.html#l00059">SyncStateManager.cs:59</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser_html_a7ac032a9c314f1d9f9d21050c88fad03"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a7ac032a9c314f1d9f9d21050c88fad03">SuiteCRMAddIn.BusinessLogic.Synchroniser.ParseDateTimeFromUserProperty</a></div><div class="ttdeci">DateTime ParseDateTimeFromUserProperty(string propertyValue)</div><div class="ttdoc">Parse a date time object from a user property, assuming the ISO 8601 date-time format but ommitting t...</div><div class="ttdef"><b>Definition:</b> <a href="_synchroniser_8cs_source.html#l00844">Synchroniser.cs:844</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_crm_id_html_a602096cd3ec71629ce3da05e4a037550"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_crm_id.html#a602096cd3ec71629ce3da05e4a037550">SuiteCRMAddIn.BusinessLogic.CrmId.Empty</a></div><div class="ttdeci">static readonly CrmId Empty</div><div class="ttdef"><b>Definition:</b> <a href="_crm_id_8cs_source.html#l00037">CrmId.cs:37</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser_html_a19871d95386a55fdb513f3e80c1fb595"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a19871d95386a55fdb513f3e80c1fb595">SuiteCRMAddIn.BusinessLogic.Synchroniser.MergeRecordsFromCrm</a></div><div class="ttdeci">virtual IList&lt; EntryValue &gt; MergeRecordsFromCrm(MAPIFolder folder, string crmModule, HashSet&lt; SyncState&lt; OutlookItemType &gt;&gt; untouched)</div><div class="ttdoc">Fetch records in pages from CRM, and merge them into Outlook. </div><div class="ttdef"><b>Definition:</b> <a href="_synchroniser_8cs_source.html#l00669">Synchroniser.cs:669</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_properties_1_1_settings_html"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_properties_1_1_settings.html">SuiteCRMAddIn.Properties.Settings</a></div><div class="ttdef"><b>Definition:</b> <a href="_suite_c_r_m_add_in_2_properties_2_settings_8_designer_8cs_source.html#l00016">Settings.Designer.cs:16</a></div></div>
<div class="ttc" id="class_suite_c_r_m_client_1_1_r_e_s_t_objects_1_1_entry_value_html"><div class="ttname"><a href="class_suite_c_r_m_client_1_1_r_e_s_t_objects_1_1_entry_value.html">SuiteCRMClient.RESTObjects.EntryValue</a></div><div class="ttdef"><b>Definition:</b> <a href="_entry_value_8cs_source.html#l00032">EntryValue.cs:32</a></div></div>
<div class="ttc" id="namespace_suite_c_r_m_add_in_1_1_properties_html"><div class="ttname"><a href="namespace_suite_c_r_m_add_in_1_1_properties.html">SuiteCRMAddIn.Properties</a></div><div class="ttdef"><b>Definition:</b> <a href="_resources_8_designer_8cs_source.html#l00011">Resources.Designer.cs:11</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser_html_a7d45b163936a827d497ad7083f098bff"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a7d45b163936a827d497ad7083f098bff">SuiteCRMAddIn.BusinessLogic.Synchroniser.Items_ItemRemove</a></div><div class="ttdeci">void Items_ItemRemove()</div><div class="ttdef"><b>Definition:</b> <a href="_synchroniser_8cs_source.html#l00649">Synchroniser.cs:649</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_daemon_1_1_daemon_worker_html"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_daemon_1_1_daemon_worker.html">SuiteCRMAddIn.Daemon.DaemonWorker</a></div><div class="ttdoc">A thing which maintains a queue of tasks (instances of DaemonAction) and executes them in turn...</div><div class="ttdef"><b>Definition:</b> <a href="_daemon_worker_8cs_source.html#l00037">DaemonWorker.cs:37</a></div></div>
<div class="ttc" id="class_suite_c_r_m_client_1_1_r_e_s_t_objects_1_1_entry_list_html"><div class="ttname"><a href="class_suite_c_r_m_client_1_1_r_e_s_t_objects_1_1_entry_list.html">SuiteCRMClient.RESTObjects.EntryList</a></div><div class="ttdef"><b>Definition:</b> <a href="_entry_list_8cs_source.html#l00027">EntryList.cs:27</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_daemon_1_1_daemon_worker_html_a759291681be3f2fd27ee7e82f0547fb6"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_daemon_1_1_daemon_worker.html#a759291681be3f2fd27ee7e82f0547fb6">SuiteCRMAddIn.Daemon.DaemonWorker.AddTask</a></div><div class="ttdeci">void AddTask(DaemonAction task)</div><div class="ttdoc">Add a task to my queue. </div><div class="ttdef"><b>Definition:</b> <a href="_daemon_worker_8cs_source.html#l00078">DaemonWorker.cs:78</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_crm_id_html_ae8a022a1d7034b495864a55ede1e0e72"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_crm_id.html#ae8a022a1d7034b495864a55ede1e0e72">SuiteCRMAddIn.BusinessLogic.CrmId.IsValid</a></div><div class="ttdeci">static bool IsValid(string id)</div><div class="ttdoc">Validates a CRM id. </div><div class="ttdef"><b>Definition:</b> <a href="_crm_id_8cs_source.html#l00097">CrmId.cs:97</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser_html_a3d0872dc57498d7b42f4fcf7a4652d6b"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a3d0872dc57498d7b42f4fcf7a4652d6b">SuiteCRMAddIn.BusinessLogic.Synchroniser.PerformIteration</a></div><div class="ttdeci">override void PerformIteration()</div><div class="ttdoc">If I am currently configured to do so, synchronise the items for which I am responsible once...</div><div class="ttdef"><b>Definition:</b> <a href="_synchroniser_8cs_source.html#l00347">Synchroniser.cs:347</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_context_html_a5a83c6e29927537191c0755578c5569b"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_context.html#a5a83c6e29927537191c0755578c5569b">SuiteCRMAddIn.BusinessLogic.SyncContext.Application</a></div><div class="ttdeci">Outlook.Application Application</div><div class="ttdef"><b>Definition:</b> <a href="_sync_context_8cs_source.html#l00042">SyncContext.cs:42</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_crm_id_html_ae39696f7859e5917afcba56aefeca1d1"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_crm_id.html#ae39696f7859e5917afcba56aefeca1d1">SuiteCRMAddIn.BusinessLogic.CrmId.ToString</a></div><div class="ttdeci">override string ToString()</div><div class="ttdef"><b>Definition:</b> <a href="_crm_id_8cs_source.html#l00084">CrmId.cs:84</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser_html_a9c37b1a01f04b2b611f21b0059497b46"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a9c37b1a01f04b2b611f21b0059497b46">SuiteCRMAddIn.BusinessLogic.Synchroniser.IsManualOverride</a></div><div class="ttdeci">virtual bool IsManualOverride(OutlookItemType olItem)</div><div class="ttdoc">Returns true if this olItem has a manual override allowing it to be synced while synchronisation is d...</div><div class="ttdef"><b>Definition:</b> <a href="_synchroniser_8cs_source.html#l01116">Synchroniser.cs:1116</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser_html_a9083c41b17e06cc70f6148b53c132b45"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a9083c41b17e06cc70f6148b53c132b45">SuiteCRMAddIn.BusinessLogic.Synchroniser.ShouldAddOrUpdateItemFromCrmToOutlook</a></div><div class="ttdeci">virtual bool ShouldAddOrUpdateItemFromCrmToOutlook(MAPIFolder folder, string crmType, EntryValue crmItem)</div><div class="ttdoc">Specialisations should return false if there&amp;#39;s a good reason why we should NOT sync this item...</div><div class="ttdef"><b>Definition:</b> <a href="_synchroniser_8cs_source.html#l01029">Synchroniser.cs:1029</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser_html_a2770863b6c4065b62d5fb72abd0927d3"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a2770863b6c4065b62d5fb72abd0927d3">SuiteCRMAddIn.BusinessLogic.Synchroniser.ResolveUnmatchedItems</a></div><div class="ttdeci">virtual void ResolveUnmatchedItems(IEnumerable&lt; SyncState&lt; OutlookItemType &gt;&gt; itemsToResolve)</div><div class="ttdoc">Given a list of items which exist in Outlook but are missing from CRM, resolve how to handle them...</div><div class="ttdef"><b>Definition:</b> <a href="_synchroniser_8cs_source.html#l00937">Synchroniser.cs:937</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser_html_a144c42ce6181fbb0cdfb85dd84c4c08b"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a144c42ce6181fbb0cdfb85dd84c4c08b">SuiteCRMAddIn.BusinessLogic.Synchroniser.GetSynchronisedItems</a></div><div class="ttdeci">IEnumerable&lt; WithRemovableSynchronisationProperties &gt; GetSynchronisedItems()</div><div class="ttdef"><b>Definition:</b> <a href="_synchroniser_8cs_source.html#l00318">Synchroniser.cs:318</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager_html_af450f947df4fe310424ad2de1275d6cb"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager.html#af450f947df4fe310424ad2de1275d6cb">SuiteCRMAddIn.BusinessLogic.SyncStateManager.GetSynchronisedItems</a></div><div class="ttdeci">ICollection&lt; SyncState &gt; GetSynchronisedItems()</div><div class="ttdoc">Get all the syncstates I am holding. </div><div class="ttdef"><b>Definition:</b> <a href="_sync_state_manager_8cs_source.html#l00195">SyncStateManager.cs:195</a></div></div>
<div class="ttc" id="class_suite_c_r_m_client_1_1_rest_a_p_i_wrapper_html_a7d8a3f489c3f14462f6a6732939e95be"><div class="ttname"><a href="class_suite_c_r_m_client_1_1_rest_a_p_i_wrapper.html#a7d8a3f489c3f14462f6a6732939e95be">SuiteCRMClient.RestAPIWrapper.SetNameValuePair</a></div><div class="ttdeci">static NameValue SetNameValuePair(string name, object value)</div><div class="ttdef"><b>Definition:</b> <a href="_rest_a_p_i_wrapper_8cs_source.html#l00498">RestAPIWrapper.cs:498</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser_html_a4d2408df659e4a9e60d08c22ef9843b7"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a4d2408df659e4a9e60d08c22ef9843b7">SuiteCRMAddIn.BusinessLogic.Synchroniser.AddOrUpdateItemFromOutlookToCrm</a></div><div class="ttdeci">virtual CrmId AddOrUpdateItemFromOutlookToCrm(SyncState&lt; OutlookItemType &gt; syncState)</div><div class="ttdoc">Add the item implied by this SyncState, which may not exist in CRM, to CRM. </div><div class="ttdef"><b>Definition:</b> <a href="_synchroniser_8cs_source.html#l00229">Synchroniser.cs:229</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser_html_a2a3bba05bc1eaf3c7d0aa367748fa4fa"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a2a3bba05bc1eaf3c7d0aa367748fa4fa">SuiteCRMAddIn.BusinessLogic.Synchroniser.EnsureSynchronisationPropertiesForOutlookItem</a></div><div class="ttdeci">void EnsureSynchronisationPropertiesForOutlookItem(OutlookItemType olItem, string modifiedDate, string type, CrmId entryId)</div><div class="ttdoc">Every Outlook item which is to be synchronised must have a property SOModifiedDate, a property SType, and a property SEntryId, referencing respectively the last time it was modified, the type of CRM item it is to be synchronised with, and the id of the CRM item it is to be synchronised with. </div><div class="ttdef"><b>Definition:</b> <a href="_synchroniser_8cs_source.html#l00449">Synchroniser.cs:449</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_crm_id_html"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_crm_id.html">SuiteCRMAddIn.BusinessLogic.CrmId</a></div><div class="ttdoc">A validated CRM id. </div><div class="ttdef"><b>Definition:</b> <a href="_crm_id_8cs_source.html#l00035">CrmId.cs:35</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_context_html_ac800c823d97baf0a18035333cb1fbe2d"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_context.html#ac800c823d97baf0a18035333cb1fbe2d">SuiteCRMAddIn.BusinessLogic.SyncContext.Log</a></div><div class="ttdeci">ILogger Log</div><div class="ttdef"><b>Definition:</b> <a href="_sync_context_8cs_source.html#l00044">SyncContext.cs:44</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager_html_ab822ec09626e62fba91fe67405875c4b"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager.html#ab822ec09626e62fba91fe67405875c4b">SuiteCRMAddIn.BusinessLogic.SyncStateManager.RemoveSyncState</a></div><div class="ttdeci">void RemoveSyncState(SyncState state)</div><div class="ttdoc">Remove all references to this sync state, if I hold any. </div><div class="ttdef"><b>Definition:</b> <a href="_sync_state_manager_8cs_source.html#l00927">SyncStateManager.cs:927</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_daemon_1_1_transmit_update_action_html"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_daemon_1_1_transmit_update_action.html">SuiteCRMAddIn.Daemon.TransmitUpdateAction</a></div><div class="ttdoc">An action to transmit to the server an item which is not a new item, but already has a SyncState...</div><div class="ttdef"><b>Definition:</b> <a href="_transmit_update_action_8cs_source.html#l00038">TransmitUpdateAction.cs:38</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager_html_af0d4d3f7b3761a69932991160d62d2e1"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager.html#af0d4d3f7b3761a69932991160d62d2e1">SuiteCRMAddIn.BusinessLogic.SyncStateManager.CrmIdPropertyName</a></div><div class="ttdeci">static string CrmIdPropertyName</div><div class="ttdoc">The name of the CRM ID synchronisation property. </div><div class="ttdef"><b>Definition:</b> <a href="_sync_state_manager_8cs_source.html#l00065">SyncStateManager.cs:65</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_globals_html"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_globals.html">SuiteCRMAddIn.Globals</a></div><div class="ttdef"><b>Definition:</b> <a href="_this_add_in_8_designer_8cs_source.html#l00171">ThisAddIn.Designer.cs:171</a></div></div>
<div class="ttc" id="namespace_suite_c_r_m_add_in_1_1_business_logic_html_a46e26c41850a74036449e03576981875"><div class="ttname"><a href="namespace_suite_c_r_m_add_in_1_1_business_logic.html#a46e26c41850a74036449e03576981875">SuiteCRMAddIn.BusinessLogic.TransmissionState</a></div><div class="ttdeci">TransmissionState</div><div class="ttdoc">States a SyncState object can be in with regard to transmission and synchronisation with CRM...</div><div class="ttdef"><b>Definition:</b> <a href="_transmission_state_8cs_source.html#l00007">TransmissionState.cs:7</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager_html_a449408102ad970c15d3df7641fafcab2"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager.html#a449408102ad970c15d3df7641fafcab2">SuiteCRMAddIn.BusinessLogic.SyncStateManager.Instance</a></div><div class="ttdeci">static SyncStateManager Instance</div><div class="ttdoc">A public accessor for my instance. </div><div class="ttdef"><b>Definition:</b> <a href="_sync_state_manager_8cs_source.html#l00124">SyncStateManager.cs:124</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser_html_addd935fc45782a1f55cc1904cef7b4c0"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#addd935fc45782a1f55cc1904cef7b4c0">SuiteCRMAddIn.BusinessLogic.Synchroniser.RemoveFromCrm</a></div><div class="ttdeci">virtual void RemoveFromCrm(SyncState state)</div><div class="ttdoc">Remove the item implied by this sync state from CRM. </div><div class="ttdef"><b>Definition:</b> <a href="_synchroniser_8cs_source.html#l00887">Synchroniser.cs:887</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_direction_html"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_direction.html">SuiteCRMAddIn.BusinessLogic.SyncDirection</a></div><div class="ttdoc">A direction in which things may be synchronised. Directions are named with respect to CRM...</div><div class="ttdef"><b>Definition:</b> <a href="_sync_direction_8cs_source.html#l00029">SyncDirection.cs:29</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser_html_ae8232f960832e22b0c8063340a297a3f"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#ae8232f960832e22b0c8063340a297a3f">SuiteCRMAddIn.BusinessLogic.Synchroniser.EnsureSynchronisationPropertiesForOutlookItem</a></div><div class="ttdeci">void EnsureSynchronisationPropertiesForOutlookItem(OutlookItemType olItem, DateTime modifiedDate, string type, CrmId entryId)</div><div class="ttdoc">Every Outlook item which is to be synchronised must have a property SOModifiedDate, a property SType, and a property SEntryId, referencing respectively the last time it was modified, the type of CRM item it is to be synchronised with, and the id of the CRM item it is to be synchronised with. </div><div class="ttdef"><b>Definition:</b> <a href="_synchroniser_8cs_source.html#l00518">Synchroniser.cs:518</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager_html_a1be6c51a0b433eb8ae2ffa27f5cc1325"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager.html#a1be6c51a0b433eb8ae2ffa27f5cc1325">SuiteCRMAddIn.BusinessLogic.SyncStateManager.GetExistingSyncState</a></div><div class="ttdeci">SyncState GetExistingSyncState(EntryValue crmItem)</div><div class="ttdoc">Get the existing sync state for this CRM item, if it exists, else null. </div><div class="ttdef"><b>Definition:</b> <a href="_sync_state_manager_8cs_source.html#l00441">SyncStateManager.cs:441</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser_html_a5cd22de84e141952672c751ecaad520b"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a5cd22de84e141952672c751ecaad520b">SuiteCRMAddIn.BusinessLogic.Synchroniser.Dispose</a></div><div class="ttdeci">void Dispose()</div><div class="ttdef"><b>Definition:</b> <a href="_synchroniser_8cs_source.html#l00157">Synchroniser.cs:157</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_globals_html_a7003a84165898c49d89498f9bd9659c5"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_globals.html#a7003a84165898c49d89498f9bd9659c5">SuiteCRMAddIn.Globals.ThisAddIn</a></div><div class="ttdeci">static ThisAddIn ThisAddIn</div><div class="ttdef"><b>Definition:</b> <a href="_this_add_in_8_designer_8cs_source.html#l00185">ThisAddIn.Designer.cs:185</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser_html_aeba73872260cea816f85c963be323771"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#aeba73872260cea816f85c963be323771">SuiteCRMAddIn.BusinessLogic.Synchroniser.ShouldPerformSyncNow</a></div><div class="ttdeci">bool ShouldPerformSyncNow(SyncState&lt; OutlookItemType &gt; syncState)</div><div class="ttdoc">Should the item represented by this sync state be synchronised now? </div><div class="ttdef"><b>Definition:</b> <a href="_synchroniser_8cs_source.html#l01127">Synchroniser.cs:1127</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_exceptions_1_1_bad_state_transition_html"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_exceptions_1_1_bad_state_transition.html">SuiteCRMAddIn.Exceptions.BadStateTransition</a></div><div class="ttdoc">An exception thrown when an unexpected transition is made on a syncstate. </div><div class="ttdef"><b>Definition:</b> <a href="_bad_state_transition_8cs_source.html#l00033">BadStateTransition.cs:33</a></div></div>
<div class="ttc" id="class_suite_c_r_m_client_1_1_rest_a_p_i_wrapper_html_ad68d42762e45541a293986a208c20656"><div class="ttname"><a href="class_suite_c_r_m_client_1_1_rest_a_p_i_wrapper.html#ad68d42762e45541a293986a208c20656">SuiteCRMClient.RestAPIWrapper.SetEntry</a></div><div class="ttdeci">static string SetEntry(NameValueCollection data, string moduleName)</div><div class="ttdoc">Sets an entry in CRM and returns the id. </div><div class="ttdef"><b>Definition:</b> <a href="_rest_a_p_i_wrapper_8cs_source.html#l00272">RestAPIWrapper.cs:272</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser_html_aac406ef7aa726441dda72708d1f28506"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#aac406ef7aa726441dda72708d1f28506">SuiteCRMAddIn.BusinessLogic.Synchroniser.RemoveEventHandlers</a></div><div class="ttdeci">virtual void RemoveEventHandlers()</div><div class="ttdef"><b>Definition:</b> <a href="_synchroniser_8cs_source.html#l00871">Synchroniser.cs:871</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_properties_1_1_settings_html_a8e51bc530341ca80c3d0f787cfcae1c8"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_properties_1_1_settings.html#a8e51bc530341ca80c3d0f787cfcae1c8">SuiteCRMAddIn.Properties.Settings.SyncMaxRecords</a></div><div class="ttdeci">int SyncMaxRecords</div><div class="ttdef"><b>Definition:</b> <a href="_suite_c_r_m_add_in_2_properties_2_settings_8_designer_8cs_source.html#l00180">Settings.Designer.cs:180</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser_html_aca3f77307c81cf5192087bc033971373"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#aca3f77307c81cf5192087bc033971373">SuiteCRMAddIn.BusinessLogic.Synchroniser.HandleItemMissingFromOutlook</a></div><div class="ttdeci">virtual void HandleItemMissingFromOutlook(SyncState&lt; OutlookItemType &gt; syncState)</div><div class="ttdoc">Deal with an item which used to exist in Outlook but which no longer does. The default behaviour is t...</div><div class="ttdef"><b>Definition:</b> <a href="_synchroniser_8cs_source.html#l00330">Synchroniser.cs:330</a></div></div>
<div class="ttc" id="class_suite_c_r_m_client_1_1_r_e_s_t_objects_1_1_entry_value_html_a6ff81b41c04d9c891efbafabc25f335f"><div class="ttname"><a href="class_suite_c_r_m_client_1_1_r_e_s_t_objects_1_1_entry_value.html#a6ff81b41c04d9c891efbafabc25f335f">SuiteCRMClient.RESTObjects.EntryValue.GetValueAsString</a></div><div class="ttdeci">string GetValueAsString(string key)</div><div class="ttdef"><b>Definition:</b> <a href="_entry_value_8cs_source.html#l00091">EntryValue.cs:91</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser_html_a810c422c6b3427bfe7b4c30f17cda22e"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a810c422c6b3427bfe7b4c30f17cda22e">SuiteCRMAddIn.BusinessLogic.Synchroniser.Items_ItemChange</a></div><div class="ttdeci">void Items_ItemChange(object olItem)</div><div class="ttdef"><b>Definition:</b> <a href="_synchroniser_8cs_source.html#l00630">Synchroniser.cs:630</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_direction_html_ad456cb19bab5eb78bc35f7b305274d01"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_direction.html#ad456cb19bab5eb78bc35f7b305274d01">SuiteCRMAddIn.BusinessLogic.SyncDirection.AllowOutbound</a></div><div class="ttdeci">static bool AllowOutbound(Direction direction)</div><div class="ttdoc">Does this direction allow outbound transfers from Outlook? </div><div class="ttdef"><b>Definition:</b> <a href="_sync_direction_8cs_source.html#l00088">SyncDirection.cs:88</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager_html_ac8238c928477c231d5b65bc8c6502048"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_manager.html#ac8238c928477c231d5b65bc8c6502048">SuiteCRMAddIn.BusinessLogic.SyncStateManager.ModifiedDatePropertyName</a></div><div class="ttdeci">const string ModifiedDatePropertyName</div><div class="ttdoc">The name of the modified date synchronisation property, which should be updated to the date/time the ...</div><div class="ttdef"><b>Definition:</b> <a href="_sync_state_manager_8cs_source.html#l00054">SyncStateManager.cs:54</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_direction_html_a96a16ea01111b3c05734e87d75eeef96"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_direction.html#a96a16ea01111b3c05734e87d75eeef96">SuiteCRMAddIn.BusinessLogic.SyncDirection.AllowInbound</a></div><div class="ttdeci">static bool AllowInbound(Direction direction)</div><div class="ttdoc">Does this direction allow inbound transfers to Outlook? </div><div class="ttdef"><b>Definition:</b> <a href="_sync_direction_8cs_source.html#l00078">SyncDirection.cs:78</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser_html_a9f9e083b51bdf10fd1236a4d34e3fad2"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a9f9e083b51bdf10fd1236a4d34e3fad2">SuiteCRMAddIn.BusinessLogic.Synchroniser.EnsureSynchronisationPropertyForOutlookItem</a></div><div class="ttdeci">void EnsureSynchronisationPropertyForOutlookItem(OutlookItemType olItem, string name, CrmId value)</div><div class="ttdef"><b>Definition:</b> <a href="_synchroniser_8cs_source.html#l00534">Synchroniser.cs:534</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_context_html"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_context.html">SuiteCRMAddIn.BusinessLogic.SyncContext</a></div><div class="ttdoc">A bundle of handles onto all the things which are needed to allow synchronisation to take place...</div><div class="ttdef"><b>Definition:</b> <a href="_sync_context_8cs_source.html#l00031">SyncContext.cs:31</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser_html_a786c50482874e295e00fd79c009b478e"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a786c50482874e295e00fd79c009b478e">SuiteCRMAddIn.BusinessLogic.Synchroniser.PrepareShutdown</a></div><div class="ttdeci">override int PrepareShutdown()</div><div class="ttdoc">Prepare me for shutdown by removing my event handlers. </div><div class="ttdef"><b>Definition:</b> <a href="_synchroniser_8cs_source.html#l00196">Synchroniser.cs:196</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser_html_a45e51c5fe658ba1c5a6f8ddd87851023"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a45e51c5fe658ba1c5a6f8ddd87851023">SuiteCRMAddIn.BusinessLogic.Synchroniser.RemoveItemAndSyncState</a></div><div class="ttdeci">void RemoveItemAndSyncState(SyncState&lt; OutlookItemType &gt; syncState)</div><div class="ttdoc">Remove an outlook item and its associated sync state. </div><div class="ttdef"><b>Definition:</b> <a href="_synchroniser_8cs_source.html#l00908">Synchroniser.cs:908</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser_html_a1cc49b75450a21630b653286b3743514"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a1cc49b75450a21630b653286b3743514">SuiteCRMAddIn.BusinessLogic.Synchroniser.FindMatches</a></div><div class="ttdeci">List&lt; SyncState&lt; OutlookItemType &gt; &gt; FindMatches(EntryValue crmItem)</div><div class="ttdoc">Find any existing Outlook items which appear to be identical to this CRM item. </div><div class="ttdef"><b>Definition:</b> <a href="_synchroniser_8cs_source.html#l00544">Synchroniser.cs:544</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser_html_ad231f4994aa37e0030879afff29d2f8c"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#ad231f4994aa37e0030879afff29d2f8c">SuiteCRMAddIn.BusinessLogic.Synchroniser.SynchroniseAll</a></div><div class="ttdeci">virtual void SynchroniseAll()</div><div class="ttdoc">Run a single iteration of the synchronisation process for the items for which I am responsible...</div><div class="ttdef"><b>Definition:</b> <a href="_synchroniser_8cs_source.html#l00205">Synchroniser.cs:205</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state_html"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_sync_state.html">SuiteCRMAddIn.BusinessLogic.SyncState</a></div><div class="ttdoc">Superclass for SyncState&lt;ItemType&gt;, q.v.. </div><div class="ttdef"><b>Definition:</b> <a href="_sync_state_8cs_source.html#l00035">SyncState.cs:35</a></div></div>
<div class="ttc" id="class_suite_c_r_m_client_1_1_rest_a_p_i_wrapper_html_a322f04a8f26c73e5e43181a041c48c27"><div class="ttname"><a href="class_suite_c_r_m_client_1_1_rest_a_p_i_wrapper.html#a322f04a8f26c73e5e43181a041c48c27">SuiteCRMClient.RestAPIWrapper.GetSugarFields</a></div><div class="ttdeci">static string [] GetSugarFields(string module)</div><div class="ttdef"><b>Definition:</b> <a href="_rest_a_p_i_wrapper_8cs_source.html#l00772">RestAPIWrapper.cs:772</a></div></div>
<div class="ttc" id="class_suite_c_r_m_client_1_1_r_e_s_t_objects_1_1_name_value_html"><div class="ttname"><a href="class_suite_c_r_m_client_1_1_r_e_s_t_objects_1_1_name_value.html">SuiteCRMClient.RESTObjects.NameValue</a></div><div class="ttdef"><b>Definition:</b> <a href="_name_value_8cs_source.html#l00030">NameValue.cs:30</a></div></div>
<div class="ttc" id="namespace_suite_c_r_m_client_html"><div class="ttname"><a href="namespace_suite_c_r_m_client.html">SuiteCRMClient</a></div><div class="ttdoc">SuiteCRMClient is a client library for the SuiteCRM JSON API. </div></div>
<div class="ttc" id="class_suite_c_r_m_client_1_1_rest_a_p_i_wrapper_html_a5822333b659d878ccd356ddcd28d466b"><div class="ttname"><a href="class_suite_c_r_m_client_1_1_rest_a_p_i_wrapper.html#a5822333b659d878ccd356ddcd28d466b">SuiteCRMClient.RestAPIWrapper.GetEntryList</a></div><div class="ttdeci">static EntryList GetEntryList(string module, string query, int limit, string order_by, int offset, bool getDeleted, string[] fields, object linkNamesToFieldsArray=null)</div><div class="ttdoc">Get the specified entries from the specified module. </div><div class="ttdef"><b>Definition:</b> <a href="_rest_a_p_i_wrapper_8cs_source.html#l00559">RestAPIWrapper.cs:559</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_daemon_1_1_daemon_worker_html_a7cd50a597c99ce8c1167eee208224e37"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_daemon_1_1_daemon_worker.html#a7cd50a597c99ce8c1167eee208224e37">SuiteCRMAddIn.Daemon.DaemonWorker.Instance</a></div><div class="ttdeci">static DaemonWorker Instance</div><div class="ttdoc">A public accessor for my instance. </div><div class="ttdef"><b>Definition:</b> <a href="_daemon_worker_8cs_source.html#l00053">DaemonWorker.cs:53</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser_html"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html">SuiteCRMAddIn.BusinessLogic.Synchroniser</a></div><div class="ttdef"><b>Definition:</b> <a href="_synchroniser_8cs_source.html#l00045">Synchroniser.cs:45</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser_html_a1607be610d388bff188e5416143f2d80"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#a1607be610d388bff188e5416143f2d80">SuiteCRMAddIn.BusinessLogic.Synchroniser.Items_ItemAdd</a></div><div class="ttdeci">void Items_ItemAdd(object olItem)</div><div class="ttdef"><b>Definition:</b> <a href="_synchroniser_8cs_source.html#l00617">Synchroniser.cs:617</a></div></div>
<div class="ttc" id="namespace_suite_c_r_m_add_in_html"><div class="ttname"><a href="namespace_suite_c_r_m_add_in.html">SuiteCRMAddIn</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_exceptions_1_1_bad_state_transition_html_a1479efcb8b54c404c2c2c646818d3525"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_exceptions_1_1_bad_state_transition.html#a1479efcb8b54c404c2c2c646818d3525">SuiteCRMAddIn.Exceptions.BadStateTransition.From</a></div><div class="ttdeci">TransmissionState From</div><div class="ttdef"><b>Definition:</b> <a href="_bad_state_transition_8cs_source.html#l00035">BadStateTransition.cs:35</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_error_handler_html_aa5ac5699b0099c7a812a895751df5e07"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_error_handler.html#aa5ac5699b0099c7a812a895751df5e07">SuiteCRMAddIn.BusinessLogic.ErrorHandler.Handle</a></div><div class="ttdeci">static void Handle(Exception error)</div><div class="ttdef"><b>Definition:</b> <a href="_error_handler_8cs_source.html#l00040">ErrorHandler.cs:40</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_error_handler_html"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_error_handler.html">SuiteCRMAddIn.BusinessLogic.ErrorHandler</a></div><div class="ttdef"><b>Definition:</b> <a href="_error_handler_8cs_source.html#l00037">ErrorHandler.cs:37</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser_html_ae70f557504f2456395b04b772ddc3753"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_business_logic_1_1_synchroniser.html#ae70f557504f2456395b04b772ddc3753">SuiteCRMAddIn.BusinessLogic.Synchroniser.permissionsCache</a></div><div class="ttdeci">readonly CRMPermissionsCache&lt; OutlookItemType, SyncStateType &gt; permissionsCache</div><div class="ttdoc">A cache for CRM premissions to prevent continually asking for them. </div><div class="ttdef"><b>Definition:</b> <a href="_synchroniser_8cs_source.html#l00112">Synchroniser.cs:112</a></div></div>
<div class="ttc" id="class_suite_c_r_m_client_1_1_r_e_s_t_objects_1_1_entry_value_html_a3bcbb05c30ef99a0d6bfca89345e11cc"><div class="ttname"><a href="class_suite_c_r_m_client_1_1_r_e_s_t_objects_1_1_entry_value.html#a3bcbb05c30ef99a0d6bfca89345e11cc">SuiteCRMClient.RESTObjects.EntryValue.id</a></div><div class="ttdeci">string id</div><div class="ttdef"><b>Definition:</b> <a href="_entry_value_8cs_source.html#l00040">EntryValue.cs:40</a></div></div>
<div class="ttc" id="namespace_suite_c_r_m_add_in_1_1_daemon_html"><div class="ttname"><a href="namespace_suite_c_r_m_add_in_1_1_daemon.html">SuiteCRMAddIn.Daemon</a></div><div class="ttdoc">The Daemon package is intended to handle background tasks, unloading them from the user interface thr...</div><div class="ttdef"><b>Definition:</b> <a href="_abstract_daemon_action_8cs_source.html#l00026">AbstractDaemonAction.cs:26</a></div></div>
<div class="ttc" id="class_suite_c_r_m_add_in_1_1_daemon_1_1_transmit_new_action_html"><div class="ttname"><a href="class_suite_c_r_m_add_in_1_1_daemon_1_1_transmit_new_action.html">SuiteCRMAddIn.Daemon.TransmitNewAction</a></div><div class="ttdoc">An action to transmit to the server an item which is a new item, and does not already have a valid CR...</div><div class="ttdef"><b>Definition:</b> <a href="_transmit_new_action_8cs_source.html#l00036">TransmitNewAction.cs:36</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_3341eda471cc1faa5052bfebf1426198.html">SuiteCRMAddIn</a></li><li class="navelem"><a class="el" href="dir_3fb47a1533c09fa7ca776045a50683b4.html">BusinessLogic</a></li><li class="navelem"><a class="el" href="_synchroniser_8cs.html">Synchroniser.cs</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
